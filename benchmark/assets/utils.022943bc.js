var Ar=Object.defineProperty;var Rr=(t,e,r)=>e in t?Ar(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var me=(t,e,r)=>(Rr(t,typeof e!="symbol"?e+"":e,r),r);var ve=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ye(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mt={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(r){t.exports=r()})(function(){return function r(n,o,i){function a(u,h){if(!o[u]){if(!n[u]){var _=typeof ye=="function"&&ye;if(!h&&_)return _(u,!0);if(s)return s(u,!0);var p=new Error("Cannot find module '"+u+"'");throw p.code="MODULE_NOT_FOUND",p}var T=o[u]={exports:{}};n[u][0].call(T.exports,function(L){var M=n[u][1][L];return a(M||L)},T,T.exports,r,n,o,i)}return o[u].exports}for(var s=typeof ye=="function"&&ye,f=0;f<i.length;f++)a(i[f]);return a}({1:[function(r,n,o){(function(i){var a=i.MutationObserver||i.WebKitMutationObserver,s;if(a){var f=0,u=new a(L),h=i.document.createTextNode("");u.observe(h,{characterData:!0}),s=function(){h.data=f=++f%2}}else if(!i.setImmediate&&typeof i.MessageChannel!="undefined"){var _=new i.MessageChannel;_.port1.onmessage=L,s=function(){_.port2.postMessage(0)}}else"document"in i&&"onreadystatechange"in i.document.createElement("script")?s=function(){var P=i.document.createElement("script");P.onreadystatechange=function(){L(),P.onreadystatechange=null,P.parentNode.removeChild(P),P=null},i.document.documentElement.appendChild(P)}:s=function(){setTimeout(L,0)};var p,T=[];function L(){p=!0;for(var P,U,D=T.length;D;){for(U=T,T=[],P=-1;++P<D;)U[P]();D=T.length}p=!1}n.exports=M;function M(P){T.push(P)===1&&!p&&s()}}).call(this,typeof ve!="undefined"?ve:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(r,n,o){var i=r(1);function a(){}var s={},f=["REJECTED"],u=["FULFILLED"],h=["PENDING"];n.exports=_;function _(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,E!==a&&M(this,E)}_.prototype.catch=function(E){return this.then(null,E)},_.prototype.then=function(E,N){if(typeof E!="function"&&this.state===u||typeof N!="function"&&this.state===f)return this;var k=new this.constructor(a);if(this.state!==h){var V=this.state===u?E:N;T(k,V,this.outcome)}else this.queue.push(new p(k,E,N));return k};function p(E,N,k){this.promise=E,typeof N=="function"&&(this.onFulfilled=N,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}p.prototype.callFulfilled=function(E){s.resolve(this.promise,E)},p.prototype.otherCallFulfilled=function(E){T(this.promise,this.onFulfilled,E)},p.prototype.callRejected=function(E){s.reject(this.promise,E)},p.prototype.otherCallRejected=function(E){T(this.promise,this.onRejected,E)};function T(E,N,k){i(function(){var V;try{V=N(k)}catch(Y){return s.reject(E,Y)}V===E?s.reject(E,new TypeError("Cannot resolve promise with itself")):s.resolve(E,V)})}s.resolve=function(E,N){var k=P(L,N);if(k.status==="error")return s.reject(E,k.value);var V=k.value;if(V)M(E,V);else{E.state=u,E.outcome=N;for(var Y=-1,J=E.queue.length;++Y<J;)E.queue[Y].callFulfilled(N)}return E},s.reject=function(E,N){E.state=f,E.outcome=N;for(var k=-1,V=E.queue.length;++k<V;)E.queue[k].callRejected(N);return E};function L(E){var N=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof N=="function")return function(){N.apply(E,arguments)}}function M(E,N){var k=!1;function V($){k||(k=!0,s.reject(E,$))}function Y($){k||(k=!0,s.resolve(E,$))}function J(){N(Y,V)}var Z=P(J);Z.status==="error"&&V(Z.value)}function P(E,N){var k={};try{k.value=E(N),k.status="success"}catch(V){k.status="error",k.value=V}return k}_.resolve=U;function U(E){return E instanceof this?E:s.resolve(new this(a),E)}_.reject=D;function D(E){var N=new this(a);return s.reject(N,E)}_.all=O;function O(E){var N=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=E.length,V=!1;if(!k)return this.resolve([]);for(var Y=new Array(k),J=0,Z=-1,$=new this(a);++Z<k;)q(E[Z],Z);return $;function q(le,_e){N.resolve(le).then(Ee,function(oe){V||(V=!0,s.reject($,oe))});function Ee(oe){Y[_e]=oe,++J===k&&!V&&(V=!0,s.resolve($,Y))}}}_.race=z;function z(E){var N=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=E.length,V=!1;if(!k)return this.resolve([]);for(var Y=-1,J=new this(a);++Y<k;)Z(E[Y]);return J;function Z($){N.resolve($).then(function(q){V||(V=!0,s.resolve(J,q))},function(q){V||(V=!0,s.reject(J,q))})}}},{1:1}],3:[function(r,n,o){(function(i){typeof i.Promise!="function"&&(i.Promise=r(2))}).call(this,typeof ve!="undefined"?ve:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{2:2}],4:[function(r,n,o){var i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};function a(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}function s(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch{return}}var f=s();function u(){try{if(!f||!f.open)return!1;var c=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),d=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!c||d)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch{return!1}}function h(c,d){c=c||[],d=d||{};try{return new Blob(c,d)}catch(g){if(g.name!=="TypeError")throw g;for(var l=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,m=new l,v=0;v<c.length;v+=1)m.append(c[v]);return m.getBlob(d.type)}}typeof Promise=="undefined"&&r(3);var _=Promise;function p(c,d){d&&c.then(function(l){d(null,l)},function(l){d(l)})}function T(c,d,l){typeof d=="function"&&c.then(d),typeof l=="function"&&c.catch(l)}function L(c){return typeof c!="string"&&(console.warn(c+" used as a key, but it is not a string."),c=String(c)),c}function M(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var P="local-forage-detect-blob-support",U=void 0,D={},O=Object.prototype.toString,z="readonly",E="readwrite";function N(c){for(var d=c.length,l=new ArrayBuffer(d),m=new Uint8Array(l),v=0;v<d;v++)m[v]=c.charCodeAt(v);return l}function k(c){return new _(function(d){var l=c.transaction(P,E),m=h([""]);l.objectStore(P).put(m,"key"),l.onabort=function(v){v.preventDefault(),v.stopPropagation(),d(!1)},l.oncomplete=function(){var v=navigator.userAgent.match(/Chrome\/(\d+)/),g=navigator.userAgent.match(/Edge\//);d(g||!v||parseInt(v[1],10)>=43)}}).catch(function(){return!1})}function V(c){return typeof U=="boolean"?_.resolve(U):k(c).then(function(d){return U=d,U})}function Y(c){var d=D[c.name],l={};l.promise=new _(function(m,v){l.resolve=m,l.reject=v}),d.deferredOperations.push(l),d.dbReady?d.dbReady=d.dbReady.then(function(){return l.promise}):d.dbReady=l.promise}function J(c){var d=D[c.name],l=d.deferredOperations.pop();if(l)return l.resolve(),l.promise}function Z(c,d){var l=D[c.name],m=l.deferredOperations.pop();if(m)return m.reject(d),m.promise}function $(c,d){return new _(function(l,m){if(D[c.name]=D[c.name]||We(),c.db)if(d)Y(c),c.db.close();else return l(c.db);var v=[c.name];d&&v.push(c.version);var g=f.open.apply(f,v);d&&(g.onupgradeneeded=function(A){var S=g.result;try{S.createObjectStore(c.storeName),A.oldVersion<=1&&S.createObjectStore(P)}catch(b){if(b.name==="ConstraintError")console.warn('The database "'+c.name+'" has been upgraded from version '+A.oldVersion+" to version "+A.newVersion+', but the storage "'+c.storeName+'" already exists.');else throw b}}),g.onerror=function(A){A.preventDefault(),m(g.error)},g.onsuccess=function(){var A=g.result;A.onversionchange=function(S){S.target.close()},l(A),J(c)}})}function q(c){return $(c,!1)}function le(c){return $(c,!0)}function _e(c,d){if(!c.db)return!0;var l=!c.db.objectStoreNames.contains(c.storeName),m=c.version<c.db.version,v=c.version>c.db.version;if(m&&(c.version!==d&&console.warn('The database "'+c.name+`" can't be downgraded from version `+c.db.version+" to version "+c.version+"."),c.version=c.db.version),v||l){if(l){var g=c.db.version+1;g>c.version&&(c.version=g)}return!0}return!1}function Ee(c){return new _(function(d,l){var m=new FileReader;m.onerror=l,m.onloadend=function(v){var g=btoa(v.target.result||"");d({__local_forage_encoded_blob:!0,data:g,type:c.type})},m.readAsBinaryString(c)})}function oe(c){var d=N(atob(c.data));return h([d],{type:c.type})}function ze(c){return c&&c.__local_forage_encoded_blob}function Rt(c){var d=this,l=d._initReady().then(function(){var m=D[d._dbInfo.name];if(m&&m.dbReady)return m.dbReady});return T(l,c,c),l}function St(c){Y(c);for(var d=D[c.name],l=d.forages,m=0;m<l.length;m++){var v=l[m];v._dbInfo.db&&(v._dbInfo.db.close(),v._dbInfo.db=null)}return c.db=null,q(c).then(function(g){return c.db=g,_e(c)?le(c):g}).then(function(g){c.db=d.db=g;for(var A=0;A<l.length;A++)l[A]._dbInfo.db=g}).catch(function(g){throw Z(c,g),g})}function j(c,d,l,m){m===void 0&&(m=1);try{var v=c.db.transaction(c.storeName,d);l(null,v)}catch(g){if(m>0&&(!c.db||g.name==="InvalidStateError"||g.name==="NotFoundError"))return _.resolve().then(function(){if(!c.db||g.name==="NotFoundError"&&!c.db.objectStoreNames.contains(c.storeName)&&c.version<=c.db.version)return c.db&&(c.version=c.db.version+1),le(c)}).then(function(){return St(c).then(function(){j(c,d,l,m-1)})}).catch(l);l(g)}}function We(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function bt(c){var d=this,l={db:null};if(c)for(var m in c)l[m]=c[m];var v=D[l.name];v||(v=We(),D[l.name]=v),v.forages.push(d),d._initReady||(d._initReady=d.ready,d.ready=Rt);var g=[];function A(){return _.resolve()}for(var S=0;S<v.forages.length;S++){var b=v.forages[S];b!==d&&g.push(b._initReady().catch(A))}var w=v.forages.slice(0);return _.all(g).then(function(){return l.db=v.db,q(l)}).then(function(I){return l.db=I,_e(l,d._defaultConfig.version)?le(l):I}).then(function(I){l.db=v.db=I,d._dbInfo=l;for(var x=0;x<w.length;x++){var F=w[x];F!==d&&(F._dbInfo.db=l.db,F._dbInfo.version=l.version)}})}function wt(c,d){var l=this;c=L(c);var m=new _(function(v,g){l.ready().then(function(){j(l._dbInfo,z,function(A,S){if(A)return g(A);try{var b=S.objectStore(l._dbInfo.storeName),w=b.get(c);w.onsuccess=function(){var I=w.result;I===void 0&&(I=null),ze(I)&&(I=oe(I)),v(I)},w.onerror=function(){g(w.error)}}catch(I){g(I)}})}).catch(g)});return p(m,d),m}function It(c,d){var l=this,m=new _(function(v,g){l.ready().then(function(){j(l._dbInfo,z,function(A,S){if(A)return g(A);try{var b=S.objectStore(l._dbInfo.storeName),w=b.openCursor(),I=1;w.onsuccess=function(){var x=w.result;if(x){var F=x.value;ze(F)&&(F=oe(F));var C=c(F,x.key,I++);C!==void 0?v(C):x.continue()}else v()},w.onerror=function(){g(w.error)}}catch(x){g(x)}})}).catch(g)});return p(m,d),m}function Tt(c,d,l){var m=this;c=L(c);var v=new _(function(g,A){var S;m.ready().then(function(){return S=m._dbInfo,O.call(d)==="[object Blob]"?V(S.db).then(function(b){return b?d:Ee(d)}):d}).then(function(b){j(m._dbInfo,E,function(w,I){if(w)return A(w);try{var x=I.objectStore(m._dbInfo.storeName);b===null&&(b=void 0);var F=x.put(b,c);I.oncomplete=function(){b===void 0&&(b=null),g(b)},I.onabort=I.onerror=function(){var C=F.error?F.error:F.transaction.error;A(C)}}catch(C){A(C)}})}).catch(A)});return p(v,l),v}function Et(c,d){var l=this;c=L(c);var m=new _(function(v,g){l.ready().then(function(){j(l._dbInfo,E,function(A,S){if(A)return g(A);try{var b=S.objectStore(l._dbInfo.storeName),w=b.delete(c);S.oncomplete=function(){v()},S.onerror=function(){g(w.error)},S.onabort=function(){var I=w.error?w.error:w.transaction.error;g(I)}}catch(I){g(I)}})}).catch(g)});return p(m,d),m}function Lt(c){var d=this,l=new _(function(m,v){d.ready().then(function(){j(d._dbInfo,E,function(g,A){if(g)return v(g);try{var S=A.objectStore(d._dbInfo.storeName),b=S.clear();A.oncomplete=function(){m()},A.onabort=A.onerror=function(){var w=b.error?b.error:b.transaction.error;v(w)}}catch(w){v(w)}})}).catch(v)});return p(l,c),l}function xt(c){var d=this,l=new _(function(m,v){d.ready().then(function(){j(d._dbInfo,z,function(g,A){if(g)return v(g);try{var S=A.objectStore(d._dbInfo.storeName),b=S.count();b.onsuccess=function(){m(b.result)},b.onerror=function(){v(b.error)}}catch(w){v(w)}})}).catch(v)});return p(l,c),l}function Dt(c,d){var l=this,m=new _(function(v,g){if(c<0){v(null);return}l.ready().then(function(){j(l._dbInfo,z,function(A,S){if(A)return g(A);try{var b=S.objectStore(l._dbInfo.storeName),w=!1,I=b.openKeyCursor();I.onsuccess=function(){var x=I.result;if(!x){v(null);return}c===0||w?v(x.key):(w=!0,x.advance(c))},I.onerror=function(){g(I.error)}}catch(x){g(x)}})}).catch(g)});return p(m,d),m}function Pt(c){var d=this,l=new _(function(m,v){d.ready().then(function(){j(d._dbInfo,z,function(g,A){if(g)return v(g);try{var S=A.objectStore(d._dbInfo.storeName),b=S.openKeyCursor(),w=[];b.onsuccess=function(){var I=b.result;if(!I){m(w);return}w.push(I.key),I.continue()},b.onerror=function(){v(b.error)}}catch(I){v(I)}})}).catch(v)});return p(l,c),l}function Mt(c,d){d=M.apply(this,arguments);var l=this.config();c=typeof c!="function"&&c||{},c.name||(c.name=c.name||l.name,c.storeName=c.storeName||l.storeName);var m=this,v;if(!c.name)v=_.reject("Invalid arguments");else{var g=c.name===l.name&&m._dbInfo.db,A=g?_.resolve(m._dbInfo.db):q(c).then(function(S){var b=D[c.name],w=b.forages;b.db=S;for(var I=0;I<w.length;I++)w[I]._dbInfo.db=S;return S});c.storeName?v=A.then(function(S){if(!!S.objectStoreNames.contains(c.storeName)){var b=S.version+1;Y(c);var w=D[c.name],I=w.forages;S.close();for(var x=0;x<I.length;x++){var F=I[x];F._dbInfo.db=null,F._dbInfo.version=b}var C=new _(function(B,W){var G=f.open(c.name,b);G.onerror=function(K){var fe=G.result;fe.close(),W(K)},G.onupgradeneeded=function(){var K=G.result;K.deleteObjectStore(c.storeName)},G.onsuccess=function(){var K=G.result;K.close(),B(K)}});return C.then(function(B){w.db=B;for(var W=0;W<I.length;W++){var G=I[W];G._dbInfo.db=B,J(G._dbInfo)}}).catch(function(B){throw(Z(c,B)||_.resolve()).catch(function(){}),B})}}):v=A.then(function(S){Y(c);var b=D[c.name],w=b.forages;S.close();for(var I=0;I<w.length;I++){var x=w[I];x._dbInfo.db=null}var F=new _(function(C,B){var W=f.deleteDatabase(c.name);W.onerror=function(){var G=W.result;G&&G.close(),B(W.error)},W.onblocked=function(){console.warn('dropInstance blocked for database "'+c.name+'" until all open connections are closed')},W.onsuccess=function(){var G=W.result;G&&G.close(),C(G)}});return F.then(function(C){b.db=C;for(var B=0;B<w.length;B++){var W=w[B];J(W._dbInfo)}}).catch(function(C){throw(Z(c,C)||_.resolve()).catch(function(){}),C})})}return p(v,d),v}var Ot={_driver:"asyncStorage",_initStorage:bt,_support:u(),iterate:It,getItem:wt,setItem:Tt,removeItem:Et,clear:Lt,length:xt,key:Dt,keys:Pt,dropInstance:Mt};function kt(){return typeof openDatabase=="function"}var te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Nt="~~local_forage_type~",Ye=/^~~local_forage_type~([^~]+)~/,ge="__lfsc__:",Le=ge.length,xe="arbf",De="blob",Je="si08",He="ui08",Ze="uic8",$e="si16",Ke="si32",Qe="ur16",qe="ui32",je="fl32",Xe="fl64",et=Le+xe.length,tt=Object.prototype.toString;function rt(c){var d=c.length*.75,l=c.length,m,v=0,g,A,S,b;c[c.length-1]==="="&&(d--,c[c.length-2]==="="&&d--);var w=new ArrayBuffer(d),I=new Uint8Array(w);for(m=0;m<l;m+=4)g=te.indexOf(c[m]),A=te.indexOf(c[m+1]),S=te.indexOf(c[m+2]),b=te.indexOf(c[m+3]),I[v++]=g<<2|A>>4,I[v++]=(A&15)<<4|S>>2,I[v++]=(S&3)<<6|b&63;return w}function Pe(c){var d=new Uint8Array(c),l="",m;for(m=0;m<d.length;m+=3)l+=te[d[m]>>2],l+=te[(d[m]&3)<<4|d[m+1]>>4],l+=te[(d[m+1]&15)<<2|d[m+2]>>6],l+=te[d[m+2]&63];return d.length%3===2?l=l.substring(0,l.length-1)+"=":d.length%3===1&&(l=l.substring(0,l.length-2)+"=="),l}function Ft(c,d){var l="";if(c&&(l=tt.call(c)),c&&(l==="[object ArrayBuffer]"||c.buffer&&tt.call(c.buffer)==="[object ArrayBuffer]")){var m,v=ge;c instanceof ArrayBuffer?(m=c,v+=xe):(m=c.buffer,l==="[object Int8Array]"?v+=Je:l==="[object Uint8Array]"?v+=He:l==="[object Uint8ClampedArray]"?v+=Ze:l==="[object Int16Array]"?v+=$e:l==="[object Uint16Array]"?v+=Qe:l==="[object Int32Array]"?v+=Ke:l==="[object Uint32Array]"?v+=qe:l==="[object Float32Array]"?v+=je:l==="[object Float64Array]"?v+=Xe:d(new Error("Failed to get type for BinaryArray"))),d(v+Pe(m))}else if(l==="[object Blob]"){var g=new FileReader;g.onload=function(){var A=Nt+c.type+"~"+Pe(this.result);d(ge+De+A)},g.readAsArrayBuffer(c)}else try{d(JSON.stringify(c))}catch(A){console.error("Couldn't convert value into a JSON string: ",c),d(null,A)}}function Vt(c){if(c.substring(0,Le)!==ge)return JSON.parse(c);var d=c.substring(et),l=c.substring(Le,et),m;if(l===De&&Ye.test(d)){var v=d.match(Ye);m=v[1],d=d.substring(v[0].length)}var g=rt(d);switch(l){case xe:return g;case De:return h([g],{type:m});case Je:return new Int8Array(g);case He:return new Uint8Array(g);case Ze:return new Uint8ClampedArray(g);case $e:return new Int16Array(g);case Qe:return new Uint16Array(g);case Ke:return new Int32Array(g);case qe:return new Uint32Array(g);case je:return new Float32Array(g);case Xe:return new Float64Array(g);default:throw new Error("Unkown type: "+l)}}var Me={serialize:Ft,deserialize:Vt,stringToBuffer:rt,bufferToString:Pe};function nt(c,d,l,m){c.executeSql("CREATE TABLE IF NOT EXISTS "+d.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],l,m)}function Ct(c){var d=this,l={db:null};if(c)for(var m in c)l[m]=typeof c[m]!="string"?c[m].toString():c[m];var v=new _(function(g,A){try{l.db=openDatabase(l.name,String(l.version),l.description,l.size)}catch(S){return A(S)}l.db.transaction(function(S){nt(S,l,function(){d._dbInfo=l,g()},function(b,w){A(w)})},A)});return l.serializer=Me,v}function re(c,d,l,m,v,g){c.executeSql(l,m,v,function(A,S){S.code===S.SYNTAX_ERR?A.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[d.storeName],function(b,w){w.rows.length?g(b,S):nt(b,d,function(){b.executeSql(l,m,v,g)},g)},g):g(A,S)},g)}function Bt(c,d){var l=this;c=L(c);var m=new _(function(v,g){l.ready().then(function(){var A=l._dbInfo;A.db.transaction(function(S){re(S,A,"SELECT * FROM "+A.storeName+" WHERE key = ? LIMIT 1",[c],function(b,w){var I=w.rows.length?w.rows.item(0).value:null;I&&(I=A.serializer.deserialize(I)),v(I)},function(b,w){g(w)})})}).catch(g)});return p(m,d),m}function Ut(c,d){var l=this,m=new _(function(v,g){l.ready().then(function(){var A=l._dbInfo;A.db.transaction(function(S){re(S,A,"SELECT * FROM "+A.storeName,[],function(b,w){for(var I=w.rows,x=I.length,F=0;F<x;F++){var C=I.item(F),B=C.value;if(B&&(B=A.serializer.deserialize(B)),B=c(B,C.key,F+1),B!==void 0){v(B);return}}v()},function(b,w){g(w)})})}).catch(g)});return p(m,d),m}function it(c,d,l,m){var v=this;c=L(c);var g=new _(function(A,S){v.ready().then(function(){d===void 0&&(d=null);var b=d,w=v._dbInfo;w.serializer.serialize(d,function(I,x){x?S(x):w.db.transaction(function(F){re(F,w,"INSERT OR REPLACE INTO "+w.storeName+" (key, value) VALUES (?, ?)",[c,I],function(){A(b)},function(C,B){S(B)})},function(F){if(F.code===F.QUOTA_ERR){if(m>0){A(it.apply(v,[c,b,l,m-1]));return}S(F)}})})}).catch(S)});return p(g,l),g}function Gt(c,d,l){return it.apply(this,[c,d,l,1])}function zt(c,d){var l=this;c=L(c);var m=new _(function(v,g){l.ready().then(function(){var A=l._dbInfo;A.db.transaction(function(S){re(S,A,"DELETE FROM "+A.storeName+" WHERE key = ?",[c],function(){v()},function(b,w){g(w)})})}).catch(g)});return p(m,d),m}function Wt(c){var d=this,l=new _(function(m,v){d.ready().then(function(){var g=d._dbInfo;g.db.transaction(function(A){re(A,g,"DELETE FROM "+g.storeName,[],function(){m()},function(S,b){v(b)})})}).catch(v)});return p(l,c),l}function Yt(c){var d=this,l=new _(function(m,v){d.ready().then(function(){var g=d._dbInfo;g.db.transaction(function(A){re(A,g,"SELECT COUNT(key) as c FROM "+g.storeName,[],function(S,b){var w=b.rows.item(0).c;m(w)},function(S,b){v(b)})})}).catch(v)});return p(l,c),l}function Jt(c,d){var l=this,m=new _(function(v,g){l.ready().then(function(){var A=l._dbInfo;A.db.transaction(function(S){re(S,A,"SELECT key FROM "+A.storeName+" WHERE id = ? LIMIT 1",[c+1],function(b,w){var I=w.rows.length?w.rows.item(0).key:null;v(I)},function(b,w){g(w)})})}).catch(g)});return p(m,d),m}function Ht(c){var d=this,l=new _(function(m,v){d.ready().then(function(){var g=d._dbInfo;g.db.transaction(function(A){re(A,g,"SELECT key FROM "+g.storeName,[],function(S,b){for(var w=[],I=0;I<b.rows.length;I++)w.push(b.rows.item(I).key);m(w)},function(S,b){v(b)})})}).catch(v)});return p(l,c),l}function Zt(c){return new _(function(d,l){c.transaction(function(m){m.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(v,g){for(var A=[],S=0;S<g.rows.length;S++)A.push(g.rows.item(S).name);d({db:c,storeNames:A})},function(v,g){l(g)})},function(m){l(m)})})}function $t(c,d){d=M.apply(this,arguments);var l=this.config();c=typeof c!="function"&&c||{},c.name||(c.name=c.name||l.name,c.storeName=c.storeName||l.storeName);var m=this,v;return c.name?v=new _(function(g){var A;c.name===l.name?A=m._dbInfo.db:A=openDatabase(c.name,"","",0),c.storeName?g({db:A,storeNames:[c.storeName]}):g(Zt(A))}).then(function(g){return new _(function(A,S){g.db.transaction(function(b){function w(C){return new _(function(B,W){b.executeSql("DROP TABLE IF EXISTS "+C,[],function(){B()},function(G,K){W(K)})})}for(var I=[],x=0,F=g.storeNames.length;x<F;x++)I.push(w(g.storeNames[x]));_.all(I).then(function(){A()}).catch(function(C){S(C)})},function(b){S(b)})})}):v=_.reject("Invalid arguments"),p(v,d),v}var Kt={_driver:"webSQLStorage",_initStorage:Ct,_support:kt(),iterate:Ut,getItem:Bt,setItem:Gt,removeItem:zt,clear:Wt,length:Yt,key:Jt,keys:Ht,dropInstance:$t};function Qt(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function at(c,d){var l=c.name+"/";return c.storeName!==d.storeName&&(l+=c.storeName+"/"),l}function qt(){var c="_localforage_support_test";try{return localStorage.setItem(c,!0),localStorage.removeItem(c),!1}catch{return!0}}function jt(){return!qt()||localStorage.length>0}function Xt(c){var d=this,l={};if(c)for(var m in c)l[m]=c[m];return l.keyPrefix=at(c,d._defaultConfig),jt()?(d._dbInfo=l,l.serializer=Me,_.resolve()):_.reject()}function er(c){var d=this,l=d.ready().then(function(){for(var m=d._dbInfo.keyPrefix,v=localStorage.length-1;v>=0;v--){var g=localStorage.key(v);g.indexOf(m)===0&&localStorage.removeItem(g)}});return p(l,c),l}function tr(c,d){var l=this;c=L(c);var m=l.ready().then(function(){var v=l._dbInfo,g=localStorage.getItem(v.keyPrefix+c);return g&&(g=v.serializer.deserialize(g)),g});return p(m,d),m}function rr(c,d){var l=this,m=l.ready().then(function(){for(var v=l._dbInfo,g=v.keyPrefix,A=g.length,S=localStorage.length,b=1,w=0;w<S;w++){var I=localStorage.key(w);if(I.indexOf(g)===0){var x=localStorage.getItem(I);if(x&&(x=v.serializer.deserialize(x)),x=c(x,I.substring(A),b++),x!==void 0)return x}}});return p(m,d),m}function nr(c,d){var l=this,m=l.ready().then(function(){var v=l._dbInfo,g;try{g=localStorage.key(c)}catch{g=null}return g&&(g=g.substring(v.keyPrefix.length)),g});return p(m,d),m}function ir(c){var d=this,l=d.ready().then(function(){for(var m=d._dbInfo,v=localStorage.length,g=[],A=0;A<v;A++){var S=localStorage.key(A);S.indexOf(m.keyPrefix)===0&&g.push(S.substring(m.keyPrefix.length))}return g});return p(l,c),l}function ar(c){var d=this,l=d.keys().then(function(m){return m.length});return p(l,c),l}function or(c,d){var l=this;c=L(c);var m=l.ready().then(function(){var v=l._dbInfo;localStorage.removeItem(v.keyPrefix+c)});return p(m,d),m}function sr(c,d,l){var m=this;c=L(c);var v=m.ready().then(function(){d===void 0&&(d=null);var g=d;return new _(function(A,S){var b=m._dbInfo;b.serializer.serialize(d,function(w,I){if(I)S(I);else try{localStorage.setItem(b.keyPrefix+c,w),A(g)}catch(x){(x.name==="QuotaExceededError"||x.name==="NS_ERROR_DOM_QUOTA_REACHED")&&S(x),S(x)}})})});return p(v,l),v}function cr(c,d){if(d=M.apply(this,arguments),c=typeof c!="function"&&c||{},!c.name){var l=this.config();c.name=c.name||l.name,c.storeName=c.storeName||l.storeName}var m=this,v;return c.name?v=new _(function(g){c.storeName?g(at(c,m._defaultConfig)):g(c.name+"/")}).then(function(g){for(var A=localStorage.length-1;A>=0;A--){var S=localStorage.key(A);S.indexOf(g)===0&&localStorage.removeItem(S)}}):v=_.reject("Invalid arguments"),p(v,d),v}var lr={_driver:"localStorageWrapper",_initStorage:Xt,_support:Qt(),iterate:rr,getItem:tr,setItem:sr,removeItem:or,clear:er,length:ar,key:nr,keys:ir,dropInstance:cr},ur=function(d,l){return d===l||typeof d=="number"&&typeof l=="number"&&isNaN(d)&&isNaN(l)},fr=function(d,l){for(var m=d.length,v=0;v<m;){if(ur(d[v],l))return!0;v++}return!1},ot=Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"},ue={},st={},se={INDEXEDDB:Ot,WEBSQL:Kt,LOCALSTORAGE:lr},dr=[se.INDEXEDDB._driver,se.WEBSQL._driver,se.LOCALSTORAGE._driver],pe=["dropInstance"],Oe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(pe),hr={description:"",driver:dr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function _r(c,d){c[d]=function(){var l=arguments;return c.ready().then(function(){return c[d].apply(c,l)})}}function ke(){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var l in d)d.hasOwnProperty(l)&&(ot(d[l])?arguments[0][l]=d[l].slice():arguments[0][l]=d[l])}return arguments[0]}var gr=function(){function c(d){a(this,c);for(var l in se)if(se.hasOwnProperty(l)){var m=se[l],v=m._driver;this[l]=v,ue[v]||this.defineDriver(m)}this._defaultConfig=ke({},hr),this._config=ke({},this._defaultConfig,d),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return c.prototype.config=function(l){if((typeof l=="undefined"?"undefined":i(l))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var m in l){if(m==="storeName"&&(l[m]=l[m].replace(/\W/g,"_")),m==="version"&&typeof l[m]!="number")return new Error("Database version must be a number.");this._config[m]=l[m]}return"driver"in l&&l.driver?this.setDriver(this._config.driver):!0}else return typeof l=="string"?this._config[l]:this._config},c.prototype.defineDriver=function(l,m,v){var g=new _(function(A,S){try{var b=l._driver,w=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!l._driver){S(w);return}for(var I=Oe.concat("_initStorage"),x=0,F=I.length;x<F;x++){var C=I[x],B=!fr(pe,C);if((B||l[C])&&typeof l[C]!="function"){S(w);return}}var W=function(){for(var fe=function(vr){return function(){var yr=new Error("Method "+vr+" is not implemented by the current driver"),ct=_.reject(yr);return p(ct,arguments[arguments.length-1]),ct}},Ne=0,mr=pe.length;Ne<mr;Ne++){var Fe=pe[Ne];l[Fe]||(l[Fe]=fe(Fe))}};W();var G=function(fe){ue[b]&&console.info("Redefining LocalForage driver: "+b),ue[b]=l,st[b]=fe,A()};"_support"in l?l._support&&typeof l._support=="function"?l._support().then(G,S):G(!!l._support):G(!0)}catch(K){S(K)}});return T(g,m,v),g},c.prototype.driver=function(){return this._driver||null},c.prototype.getDriver=function(l,m,v){var g=ue[l]?_.resolve(ue[l]):_.reject(new Error("Driver not found."));return T(g,m,v),g},c.prototype.getSerializer=function(l){var m=_.resolve(Me);return T(m,l),m},c.prototype.ready=function(l){var m=this,v=m._driverSet.then(function(){return m._ready===null&&(m._ready=m._initDriver()),m._ready});return T(v,l,l),v},c.prototype.setDriver=function(l,m,v){var g=this;ot(l)||(l=[l]);var A=this._getSupportedDrivers(l);function S(){g._config.driver=g.driver()}function b(x){return g._extend(x),S(),g._ready=g._initStorage(g._config),g._ready}function w(x){return function(){var F=0;function C(){for(;F<x.length;){var B=x[F];return F++,g._dbInfo=null,g._ready=null,g.getDriver(B).then(b).catch(C)}S();var W=new Error("No available storage method found.");return g._driverSet=_.reject(W),g._driverSet}return C()}}var I=this._driverSet!==null?this._driverSet.catch(function(){return _.resolve()}):_.resolve();return this._driverSet=I.then(function(){var x=A[0];return g._dbInfo=null,g._ready=null,g.getDriver(x).then(function(F){g._driver=F._driver,S(),g._wrapLibraryMethodsWithReady(),g._initDriver=w(A)})}).catch(function(){S();var x=new Error("No available storage method found.");return g._driverSet=_.reject(x),g._driverSet}),T(this._driverSet,m,v),this._driverSet},c.prototype.supports=function(l){return!!st[l]},c.prototype._extend=function(l){ke(this,l)},c.prototype._getSupportedDrivers=function(l){for(var m=[],v=0,g=l.length;v<g;v++){var A=l[v];this.supports(A)&&m.push(A)}return m},c.prototype._wrapLibraryMethodsWithReady=function(){for(var l=0,m=Oe.length;l<m;l++)_r(this,Oe[l])},c.prototype.createInstance=function(l){return new c(l)},c}(),pr=new gr;n.exports=pr},{3:3}]},{},[4])(4)})})(mt);var X=mt.exports;/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */function Sr(t,e,r,n){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(i){var a=this;if(!a.ctx||!a.ctx.listener)return a;for(var s=a._howls.length-1;s>=0;s--)a._howls[s].stereo(i);return a},t.prototype.pos=function(i,a,s){var f=this;if(!f.ctx||!f.ctx.listener)return f;if(a=typeof a!="number"?f._pos[1]:a,s=typeof s!="number"?f._pos[2]:s,typeof i=="number")f._pos=[i,a,s],typeof f.ctx.listener.positionX!="undefined"?(f.ctx.listener.positionX.setTargetAtTime(f._pos[0],e.ctx.currentTime,.1),f.ctx.listener.positionY.setTargetAtTime(f._pos[1],e.ctx.currentTime,.1),f.ctx.listener.positionZ.setTargetAtTime(f._pos[2],e.ctx.currentTime,.1)):f.ctx.listener.setPosition(f._pos[0],f._pos[1],f._pos[2]);else return f._pos;return f},t.prototype.orientation=function(i,a,s,f,u,h){var _=this;if(!_.ctx||!_.ctx.listener)return _;var p=_._orientation;if(a=typeof a!="number"?p[1]:a,s=typeof s!="number"?p[2]:s,f=typeof f!="number"?p[3]:f,u=typeof u!="number"?p[4]:u,h=typeof h!="number"?p[5]:h,typeof i=="number")_._orientation=[i,a,s,f,u,h],typeof _.ctx.listener.forwardX!="undefined"?(_.ctx.listener.forwardX.setTargetAtTime(i,e.ctx.currentTime,.1),_.ctx.listener.forwardY.setTargetAtTime(a,e.ctx.currentTime,.1),_.ctx.listener.forwardZ.setTargetAtTime(s,e.ctx.currentTime,.1),_.ctx.listener.upX.setTargetAtTime(f,e.ctx.currentTime,.1),_.ctx.listener.upY.setTargetAtTime(u,e.ctx.currentTime,.1),_.ctx.listener.upZ.setTargetAtTime(h,e.ctx.currentTime,.1)):_.ctx.listener.setOrientation(i,a,s,f,u,h);else return p;return _},r.prototype.init=function(i){return function(a){var s=this;return s._orientation=a.orientation||[1,0,0],s._stereo=a.stereo||null,s._pos=a.pos||null,s._pannerAttr={coneInnerAngle:typeof a.coneInnerAngle!="undefined"?a.coneInnerAngle:360,coneOuterAngle:typeof a.coneOuterAngle!="undefined"?a.coneOuterAngle:360,coneOuterGain:typeof a.coneOuterGain!="undefined"?a.coneOuterGain:0,distanceModel:typeof a.distanceModel!="undefined"?a.distanceModel:"inverse",maxDistance:typeof a.maxDistance!="undefined"?a.maxDistance:1e4,panningModel:typeof a.panningModel!="undefined"?a.panningModel:"HRTF",refDistance:typeof a.refDistance!="undefined"?a.refDistance:1,rolloffFactor:typeof a.rolloffFactor!="undefined"?a.rolloffFactor:1},s._onstereo=a.onstereo?[{fn:a.onstereo}]:[],s._onpos=a.onpos?[{fn:a.onpos}]:[],s._onorientation=a.onorientation?[{fn:a.onorientation}]:[],i.call(this,a)}}(r.prototype.init),r.prototype.stereo=function(i,a){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,a)}}),s;var f=typeof e.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof a=="undefined")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var u=s._getSoundIds(a),h=0;h<u.length;h++){var _=s._soundById(u[h]);if(_)if(typeof i=="number")_._stereo=i,_._pos=[i,0,0],_._node&&(_._pannerAttr.panningModel="equalpower",(!_._panner||!_._panner.pan)&&o(_,f),f==="spatial"?typeof _._panner.positionX!="undefined"?(_._panner.positionX.setValueAtTime(i,e.ctx.currentTime),_._panner.positionY.setValueAtTime(0,e.ctx.currentTime),_._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):_._panner.setPosition(i,0,0):_._panner.pan.setValueAtTime(i,e.ctx.currentTime)),s._emit("stereo",_._id);else return _._stereo}return s},r.prototype.pos=function(i,a,s,f){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"pos",action:function(){u.pos(i,a,s,f)}}),u;if(a=typeof a!="number"?0:a,s=typeof s!="number"?-.5:s,typeof f=="undefined")if(typeof i=="number")u._pos=[i,a,s];else return u._pos;for(var h=u._getSoundIds(f),_=0;_<h.length;_++){var p=u._soundById(h[_]);if(p)if(typeof i=="number")p._pos=[i,a,s],p._node&&((!p._panner||p._panner.pan)&&o(p,"spatial"),typeof p._panner.positionX!="undefined"?(p._panner.positionX.setValueAtTime(i,e.ctx.currentTime),p._panner.positionY.setValueAtTime(a,e.ctx.currentTime),p._panner.positionZ.setValueAtTime(s,e.ctx.currentTime)):p._panner.setPosition(i,a,s)),u._emit("pos",p._id);else return p._pos}return u},r.prototype.orientation=function(i,a,s,f){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"orientation",action:function(){u.orientation(i,a,s,f)}}),u;if(a=typeof a!="number"?u._orientation[1]:a,s=typeof s!="number"?u._orientation[2]:s,typeof f=="undefined")if(typeof i=="number")u._orientation=[i,a,s];else return u._orientation;for(var h=u._getSoundIds(f),_=0;_<h.length;_++){var p=u._soundById(h[_]);if(p)if(typeof i=="number")p._orientation=[i,a,s],p._node&&(p._panner||(p._pos||(p._pos=u._pos||[0,0,-.5]),o(p,"spatial")),typeof p._panner.orientationX!="undefined"?(p._panner.orientationX.setValueAtTime(i,e.ctx.currentTime),p._panner.orientationY.setValueAtTime(a,e.ctx.currentTime),p._panner.orientationZ.setValueAtTime(s,e.ctx.currentTime)):p._panner.setOrientation(i,a,s)),u._emit("orientation",p._id);else return p._orientation}return u},r.prototype.pannerAttr=function(){var i=this,a=arguments,s,f,u;if(!i._webAudio)return i;if(a.length===0)return i._pannerAttr;if(a.length===1)if(typeof a[0]=="object")s=a[0],typeof f=="undefined"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle!="undefined"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle!="undefined"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain!="undefined"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel!="undefined"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance!="undefined"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance!="undefined"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor!="undefined"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel!="undefined"?s.pannerAttr.panningModel:i._panningModel});else return u=i._soundById(parseInt(a[0],10)),u?u._pannerAttr:i._pannerAttr;else a.length===2&&(s=a[0],f=parseInt(a[1],10));for(var h=i._getSoundIds(f),_=0;_<h.length;_++)if(u=i._soundById(h[_]),u){var p=u._pannerAttr;p={coneInnerAngle:typeof s.coneInnerAngle!="undefined"?s.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle!="undefined"?s.coneOuterAngle:p.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain!="undefined"?s.coneOuterGain:p.coneOuterGain,distanceModel:typeof s.distanceModel!="undefined"?s.distanceModel:p.distanceModel,maxDistance:typeof s.maxDistance!="undefined"?s.maxDistance:p.maxDistance,refDistance:typeof s.refDistance!="undefined"?s.refDistance:p.refDistance,rolloffFactor:typeof s.rolloffFactor!="undefined"?s.rolloffFactor:p.rolloffFactor,panningModel:typeof s.panningModel!="undefined"?s.panningModel:p.panningModel};var T=u._panner;T||(u._pos||(u._pos=i._pos||[0,0,-.5]),o(u,"spatial"),T=u._panner),T.coneInnerAngle=p.coneInnerAngle,T.coneOuterAngle=p.coneOuterAngle,T.coneOuterGain=p.coneOuterGain,T.distanceModel=p.distanceModel,T.maxDistance=p.maxDistance,T.refDistance=p.refDistance,T.rolloffFactor=p.rolloffFactor,T.panningModel=p.panningModel}return i},n.prototype.init=function(i){return function(){var a=this,s=a._parent;a._orientation=s._orientation,a._stereo=s._stereo,a._pos=s._pos,a._pannerAttr=s._pannerAttr,i.call(this),a._stereo?s.stereo(a._stereo):a._pos&&s.pos(a._pos[0],a._pos[1],a._pos[2],a._id)}}(n.prototype.init),n.prototype.reset=function(i){return function(){var a=this,s=a._parent;return a._orientation=s._orientation,a._stereo=s._stereo,a._pos=s._pos,a._pannerAttr=s._pannerAttr,a._stereo?s.stereo(a._stereo):a._pos?s.pos(a._pos[0],a._pos[1],a._pos[2],a._id):a._panner&&(a._panner.disconnect(0),a._panner=void 0,s._refreshBuffer(a)),i.call(this)}}(n.prototype.reset);var o=function(i,a){a=a||"spatial",a==="spatial"?(i._panner=e.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX!="undefined"?(i._panner.positionX.setValueAtTime(i._pos[0],e.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],e.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],e.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX!="undefined"?(i._panner.orientationX.setValueAtTime(i._orientation[0],e.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],e.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],e.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=e.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,e.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var Ue=function(){this.init()};Ue.prototype={init:function(){var t=this||R;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||R;if(t=parseFloat(t),e.ctx||Se(),typeof t!="undefined"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,R.ctx.currentTime);for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var n=e._howls[r]._getSoundIds(),o=0;o<n.length;o++){var i=e._howls[r]._soundById(n[o]);i&&i._node&&(i._node.volume=i._volume*t)}return e}return e._volume},mute:function(t){var e=this||R;e.ctx||Se(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,R.ctx.currentTime);for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var n=e._howls[r]._getSoundIds(),o=0;o<n.length;o++){var i=e._howls[r]._soundById(n[o]);i&&i._node&&(i._node.muted=t?!0:i._muted)}return e},stop:function(){for(var t=this||R,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||R,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close!="undefined"&&(t.ctx.close(),t.ctx=null,Se()),t},codecs:function(t){return(this||R)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||R;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio!="undefined")try{var e=new Audio;typeof e.oncanplaythrough=="undefined"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||R,e=null;try{e=typeof Audio!="undefined"?new Audio:null}catch{return t}if(!e||typeof e.canPlayType!="function")return t;var r=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",o=n.match(/OPR\/([0-6].)/g),i=o&&parseInt(o[0].split("/")[1],10)<33,a=n.indexOf("Safari")!==-1&&n.indexOf("Chrome")===-1,s=n.match(/Version\/(.*?) /),f=a&&s&&parseInt(s[1],10)<15;return t._codecs={mp3:!!(!i&&(r||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!r,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!f&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!f&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||R;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(r){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch{t.noAudio=!0;break}for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var i=t._howls[o]._getSoundIds(),a=0;a<i.length;a++){var s=t._howls[o]._soundById(i[a]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}t._autoResume();var f=t.ctx.createBufferSource();f.buffer=t._scratchBuffer,f.connect(t.ctx.destination),typeof f.start=="undefined"?f.noteOn(0):f.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),f.onended=function(){f.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var u=0;u<t._howls.length;u++)t._howls[u]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||R;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise!="undefined"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||R;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend=="undefined"||!R.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var r=0;r<t._howls[e]._sounds.length;r++)if(!t._howls[e]._sounds[r]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(!!t.autoSuspend){t._suspendTimer=null,t.state="suspending";var n=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(n,n)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume=="undefined"||!R.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var R=new Ue,be=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};be.prototype={init:function(t){var e=this;return R.ctx||Se(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=R.usingWebAudio&&!e._html5,typeof R.ctx!="undefined"&&R.ctx&&R.autoUnlock&&R._unlockAudio(),R._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(R.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var r=0;r<t._src.length;r++){var n,o;if(t._format&&t._format[r])n=t._format[r];else{if(o=t._src[r],typeof o!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}n=/^data:audio\/([^;,]+);/i.exec(o),n||(n=/\.([^.]+)$/.exec(o.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&R.codecs(n)){e=t._src[r];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new we(t),t._webAudio&&br(t),t},play:function(t,e){var r=this,n=null;if(typeof t=="number")n=t,t=null;else{if(typeof t=="string"&&r._state==="loaded"&&!r._sprite[t])return null;if(typeof t=="undefined"&&(t="__default",!r._playLock)){for(var o=0,i=0;i<r._sounds.length;i++)r._sounds[i]._paused&&!r._sounds[i]._ended&&(o++,n=r._sounds[i]._id);o===1?t=null:n=null}}var a=n?r._soundById(n):r._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),r._state!=="loaded"){a._sprite=t,a._ended=!1;var s=a._id;return r._queue.push({event:"play",action:function(){r.play(s)}}),s}if(n&&!a._paused)return e||r._loadQueue("play"),a._id;r._webAudio&&R._autoResume();var f=Math.max(0,a._seek>0?a._seek:r._sprite[t][0]/1e3),u=Math.max(0,(r._sprite[t][0]+r._sprite[t][1])/1e3-f),h=u*1e3/Math.abs(a._rate),_=r._sprite[t][0]/1e3,p=(r._sprite[t][0]+r._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var T=function(){a._paused=!1,a._seek=f,a._start=_,a._stop=p,a._loop=!!(a._loop||r._sprite[t][2])};if(f>=p){r._ended(a);return}var L=a._node;if(r._webAudio){var M=function(){r._playLock=!1,T(),r._refreshBuffer(a);var O=a._muted||r._muted?0:a._volume;L.gain.setValueAtTime(O,R.ctx.currentTime),a._playStart=R.ctx.currentTime,typeof L.bufferSource.start=="undefined"?a._loop?L.bufferSource.noteGrainOn(0,f,86400):L.bufferSource.noteGrainOn(0,f,u):a._loop?L.bufferSource.start(0,f,86400):L.bufferSource.start(0,f,u),h!==1/0&&(r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),h)),e||setTimeout(function(){r._emit("play",a._id),r._loadQueue()},0)};R.state==="running"&&R.ctx.state!=="interrupted"?M():(r._playLock=!0,r.once("resume",M),r._clearTimer(a._id))}else{var P=function(){L.currentTime=f,L.muted=a._muted||r._muted||R._muted||L.muted,L.volume=a._volume*R.volume(),L.playbackRate=a._rate;try{var O=L.play();if(O&&typeof Promise!="undefined"&&(O instanceof Promise||typeof O.then=="function")?(r._playLock=!0,T(),O.then(function(){r._playLock=!1,L._unlocked=!0,e?r._loadQueue():r._emit("play",a._id)}).catch(function(){r._playLock=!1,r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0})):e||(r._playLock=!1,T(),r._emit("play",a._id)),L.playbackRate=a._rate,L.paused){r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||a._loop?r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),h):(r._endTimers[a._id]=function(){r._ended(a),L.removeEventListener("ended",r._endTimers[a._id],!1)},L.addEventListener("ended",r._endTimers[a._id],!1))}catch(z){r._emit("playerror",a._id,z)}};L.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(L.src=r._src,L.load());var U=window&&window.ejecta||!L.readyState&&R._navigator.isCocoonJS;if(L.readyState>=3||U)P();else{r._playLock=!0,r._state="loading";var D=function(){r._state="loaded",P(),L.removeEventListener(R._canPlayEvent,D,!1)};L.addEventListener(R._canPlayEvent,D,!1),r._clearTimer(a._id)}}return a._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var r=e._getSoundIds(t),n=0;n<r.length;n++){e._clearTimer(r[n]);var o=e._soundById(r[n]);if(o&&!o._paused&&(o._seek=e.seek(r[n]),o._rateSeek=0,o._paused=!0,e._stopFade(r[n]),o._node))if(e._webAudio){if(!o._node.bufferSource)continue;typeof o._node.bufferSource.stop=="undefined"?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),e._cleanBuffer(o._node)}else(!isNaN(o._node.duration)||o._node.duration===1/0)&&o._node.pause();arguments[1]||e._emit("pause",o?o._id:null)}return e},stop:function(t,e){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"stop",action:function(){r.stop(t)}}),r;for(var n=r._getSoundIds(t),o=0;o<n.length;o++){r._clearTimer(n[o]);var i=r._soundById(n[o]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,r._stopFade(n[o]),i._node&&(r._webAudio?i._node.bufferSource&&(typeof i._node.bufferSource.stop=="undefined"?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),r._cleanBuffer(i._node)):(!isNaN(i._node.duration)||i._node.duration===1/0)&&(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&r._clearSound(i._node))),e||r._emit("stop",i._id))}return r},mute:function(t,e){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(t,e)}}),r;if(typeof e=="undefined")if(typeof t=="boolean")r._muted=t;else return r._muted;for(var n=r._getSoundIds(e),o=0;o<n.length;o++){var i=r._soundById(n[o]);i&&(i._muted=t,i._interval&&r._stopFade(i._id),r._webAudio&&i._node?i._node.gain.setValueAtTime(t?0:i._volume,R.ctx.currentTime):i._node&&(i._node.muted=R._muted?!0:t),r._emit("mute",i._id))}return r},volume:function(){var t=this,e=arguments,r,n;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]=="undefined"){var o=t._getSoundIds(),i=o.indexOf(e[0]);i>=0?n=parseInt(e[0],10):r=parseFloat(e[0])}else e.length>=2&&(r=parseFloat(e[0]),n=parseInt(e[1],10));var a;if(typeof r!="undefined"&&r>=0&&r<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof n=="undefined"&&(t._volume=r),n=t._getSoundIds(n);for(var s=0;s<n.length;s++)a=t._soundById(n[s]),a&&(a._volume=r,e[2]||t._stopFade(n[s]),t._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(r,R.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=r*R.volume()),t._emit("volume",a._id))}else return a=n?t._soundById(n):t._sounds[0],a?a._volume:0;return t},fade:function(t,e,r,n){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(t,e,r,n)}}),o;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),r=parseFloat(r),o.volume(t,n);for(var i=o._getSoundIds(n),a=0;a<i.length;a++){var s=o._soundById(i[a]);if(s){if(n||o._stopFade(i[a]),o._webAudio&&!s._muted){var f=R.ctx.currentTime,u=f+r/1e3;s._volume=t,s._node.gain.setValueAtTime(t,f),s._node.gain.linearRampToValueAtTime(e,u)}o._startFadeInterval(s,t,e,r,i[a],typeof n=="undefined")}}return o},_startFadeInterval:function(t,e,r,n,o,i){var a=this,s=e,f=r-e,u=Math.abs(f/.01),h=Math.max(4,u>0?n/u:n),_=Date.now();t._fadeTo=r,t._interval=setInterval(function(){var p=(Date.now()-_)/n;_=Date.now(),s+=f*p,s=Math.round(s*100)/100,f<0?s=Math.max(r,s):s=Math.min(r,s),a._webAudio?t._volume=s:a.volume(s,t._id,!0),i&&(a._volume=s),(r<e&&s<=r||r>e&&s>=r)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,a.volume(r,t._id),a._emit("fade",t._id))},h)},_stopFade:function(t){var e=this,r=e._soundById(t);return r&&r._interval&&(e._webAudio&&r._node.gain.cancelScheduledValues(R.ctx.currentTime),clearInterval(r._interval),r._interval=null,e.volume(r._fadeTo,t),r._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,r,n,o;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")r=e[0],t._loop=r;else return o=t._soundById(parseInt(e[0],10)),o?o._loop:!1;else e.length===2&&(r=e[0],n=parseInt(e[1],10));for(var i=t._getSoundIds(n),a=0;a<i.length;a++)o=t._soundById(i[a]),o&&(o._loop=r,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=r,r&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,t.playing(i[a])&&(t.pause(i[a],!0),t.play(i[a],!0)))));return t},rate:function(){var t=this,e=arguments,r,n;if(e.length===0)n=t._sounds[0]._id;else if(e.length===1){var o=t._getSoundIds(),i=o.indexOf(e[0]);i>=0?n=parseInt(e[0],10):r=parseFloat(e[0])}else e.length===2&&(r=parseFloat(e[0]),n=parseInt(e[1],10));var a;if(typeof r=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof n=="undefined"&&(t._rate=r),n=t._getSoundIds(n);for(var s=0;s<n.length;s++)if(a=t._soundById(n[s]),a){t.playing(n[s])&&(a._rateSeek=t.seek(n[s]),a._playStart=t._webAudio?R.ctx.currentTime:a._playStart),a._rate=r,t._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.setValueAtTime(r,R.ctx.currentTime):a._node&&(a._node.playbackRate=r);var f=t.seek(n[s]),u=(t._sprite[a._sprite][0]+t._sprite[a._sprite][1])/1e3-f,h=u*1e3/Math.abs(a._rate);(t._endTimers[n[s]]||!a._paused)&&(t._clearTimer(n[s]),t._endTimers[n[s]]=setTimeout(t._ended.bind(t,a),h)),t._emit("rate",a._id)}}else return a=t._soundById(n),a?a._rate:t._rate;return t},seek:function(){var t=this,e=arguments,r,n;if(e.length===0)t._sounds.length&&(n=t._sounds[0]._id);else if(e.length===1){var o=t._getSoundIds(),i=o.indexOf(e[0]);i>=0?n=parseInt(e[0],10):t._sounds.length&&(n=t._sounds[0]._id,r=parseFloat(e[0]))}else e.length===2&&(r=parseFloat(e[0]),n=parseInt(e[1],10));if(typeof n=="undefined")return 0;if(typeof r=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var a=t._soundById(n);if(a)if(typeof r=="number"&&r>=0){var s=t.playing(n);s&&t.pause(n,!0),a._seek=r,a._ended=!1,t._clearTimer(n),!t._webAudio&&a._node&&!isNaN(a._node.duration)&&(a._node.currentTime=r);var f=function(){s&&t.play(n,!0),t._emit("seek",n)};if(s&&!t._webAudio){var u=function(){t._playLock?setTimeout(u,0):f()};setTimeout(u,0)}else f()}else if(t._webAudio){var h=t.playing(n)?R.ctx.currentTime-a._playStart:0,_=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(_+h*Math.abs(a._rate))}else return a._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var r=e._soundById(t);return r?!r._paused:!1}for(var n=0;n<e._sounds.length;n++)if(!e._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this,r=e._duration,n=e._soundById(t);return n&&(r=e._sprite[n._sprite][1]/1e3),r},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,r=0;r<e.length;r++)e[r]._paused||t.stop(e[r]._id),t._webAudio||(t._clearSound(e[r]._node),e[r]._node.removeEventListener("error",e[r]._errorFn,!1),e[r]._node.removeEventListener(R._canPlayEvent,e[r]._loadFn,!1),e[r]._node.removeEventListener("ended",e[r]._endFn,!1),R._releaseHtml5Audio(e[r]._node)),delete e[r]._node,t._clearTimer(e[r]._id);var n=R._howls.indexOf(t);n>=0&&R._howls.splice(n,1);var o=!0;for(r=0;r<R._howls.length;r++)if(R._howls[r]._src===t._src||t._src.indexOf(R._howls[r]._src)>=0){o=!1;break}return ae&&o&&delete ae[t._src],R.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,r,n){var o=this,i=o["_on"+t];return typeof e=="function"&&i.push(n?{id:r,fn:e,once:n}:{id:r,fn:e}),o},off:function(t,e,r){var n=this,o=n["_on"+t],i=0;if(typeof e=="number"&&(r=e,e=null),e||r)for(i=0;i<o.length;i++){var a=r===o[i].id;if(e===o[i].fn&&a||!e&&a){o.splice(i,1);break}}else if(t)n["_on"+t]=[];else{var s=Object.keys(n);for(i=0;i<s.length;i++)s[i].indexOf("_on")===0&&Array.isArray(n[s[i]])&&(n[s[i]]=[])}return n},once:function(t,e,r){var n=this;return n.on(t,e,r,1),n},_emit:function(t,e,r){for(var n=this,o=n["_on"+t],i=o.length-1;i>=0;i--)(!o[i].id||o[i].id===e||t==="load")&&(setTimeout(function(a){a.call(this,e,r)}.bind(n,o[i].fn),0),o[i].once&&n.off(t,o[i].fn,o[i].id));return n._loadQueue(t),n},_loadQueue:function(t){var e=this;if(e._queue.length>0){var r=e._queue[0];r.event===t&&(e._queue.shift(),e._loadQueue()),t||r.action()}return e},_ended:function(t){var e=this,r=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!!(t._loop||e._sprite[r][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=R.ctx.currentTime;var o=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),o)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),R._autoSuspend()),!e._webAudio&&!n&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var r=e._soundById(t);r&&r._node&&r._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,r=0;r<e._sounds.length;r++)if(t===e._sounds[r]._id)return e._sounds[r];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new we(t)},_drain:function(){var t=this,e=t._pool,r=0,n=0;if(!(t._sounds.length<e)){for(n=0;n<t._sounds.length;n++)t._sounds[n]._ended&&r++;for(n=t._sounds.length-1;n>=0;n--){if(r<=e)return;t._sounds[n]._ended&&(t._webAudio&&t._sounds[n]._node&&t._sounds[n]._node.disconnect(0),t._sounds.splice(n,1),r--)}}},_getSoundIds:function(t){var e=this;if(typeof t=="undefined"){for(var r=[],n=0;n<e._sounds.length;n++)r.push(e._sounds[n]._id);return r}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=R.ctx.createBufferSource(),t._node.bufferSource.buffer=ae[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,R.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,r=R._navigator&&R._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(R._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),r))try{t.bufferSource.buffer=R._scratchBuffer}catch{}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(R._navigator&&R._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var we=function(t){this._parent=t,this.init()};we.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++R._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,r=R._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof R.ctx.createGain=="undefined"?R.ctx.createGainNode():R.ctx.createGain(),t._node.gain.setValueAtTime(r,R.ctx.currentTime),t._node.paused=!0,t._node.connect(R.masterGain)):R.noAudio||(t._node=R._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(R._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=r*R.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++R._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(R._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var ae={},br=function(t){var e=t._src;if(ae[e]){t._duration=ae[e].duration,vt(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var r=atob(e.split(",")[1]),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);lt(n.buffer,t)}else{var i=new XMLHttpRequest;i.open(t._xhr.method,e,!0),i.withCredentials=t._xhr.withCredentials,i.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(a){i.setRequestHeader(a,t._xhr.headers[a])}),i.onload=function(){var a=(i.status+"")[0];if(a!=="0"&&a!=="2"&&a!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+i.status+".");return}lt(i.response,t)},i.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete ae[e],t.load())},wr(i)}},wr=function(t){try{t.send()}catch{t.onerror()}},lt=function(t,e){var r=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(o){o&&e._sounds.length>0?(ae[e._src]=o,vt(e,o)):r()};typeof Promise!="undefined"&&R.ctx.decodeAudioData.length===1?R.ctx.decodeAudioData(t).then(n).catch(r):R.ctx.decodeAudioData(t,n,r)},vt=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},Se=function(){if(!!R.usingWebAudio){try{typeof AudioContext!="undefined"?R.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?R.ctx=new webkitAudioContext:R.usingWebAudio=!1}catch{R.usingWebAudio=!1}R.ctx||(R.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(R._navigator&&R._navigator.platform),e=R._navigator&&R._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=e?parseInt(e[1],10):null;if(t&&r&&r<9){var n=/safari/.test(R._navigator&&R._navigator.userAgent.toLowerCase());R._navigator&&!n&&(R.usingWebAudio=!1)}R.usingWebAudio&&(R.masterGain=typeof R.ctx.createGain=="undefined"?R.ctx.createGainNode():R.ctx.createGain(),R.masterGain.gain.setValueAtTime(R._muted?0:R._volume,R.ctx.currentTime),R.masterGain.connect(R.ctx.destination)),R._setup()}};Sr(Ue,R,be,we);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Label Recognizer JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.2.31 (js 20230728)
 * @fileoverview Dynamsoft JavaScript Library for Label Recognizer
 * More info on DLR JS: https://www.dynamsoft.com/label-recognizer/sdk-javascript/
 */const ie=typeof self=="undefined",ut=ie?{}:self;let de,ee,Ae,Ie,H;if(typeof navigator!="undefined"&&(de=navigator,ee=de.userAgent,Ae=de.platform,Ie=de.mediaDevices),!ie){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:de.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ae,search:"Win"},Mac:{str:Ae},Linux:{str:Ae}};let r="unknownBrowser",n=0,o="unknownOS";for(let i in t){const a=t[i]||{};let s=a.str||ee,f=a.search||i,u=a.verStr||ee,h=a.verSearch||i;if(h instanceof Array||(h=[h]),s.indexOf(f)!=-1){r=i;for(let _ of h){let p=u.indexOf(_);if(p!=-1){n=parseFloat(u.substring(p+_.length+1));break}}break}}for(let i in e){const a=e[i]||{};let s=a.str||ee,f=a.search||i;if(s.indexOf(f)!=-1){o=i;break}}o=="Linux"&&ee.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),H={browser:r,version:n,OS:o}}ie&&(H={browser:"ssr",version:0,OS:"ssr"});const Ir=typeof WebAssembly!="undefined"&&ee&&!(/Safari/.test(ee)&&!/Chrome/.test(ee)&&/\(.+\s11_2_([2-6]).*\)/.test(ee)),Tr=typeof Worker!="undefined",yt=!(!Ie||!Ie.getUserMedia),Er=async()=>{let t=!1;if(yt)try{(await Ie.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};H.browser==="Chrome"&&H.version>66||H.browser==="Safari"&&H.version>13||H.browser==="OPR"&&H.version>43||H.browser==="Edge"&&H.version;const Lr=(()=>{if(!ie&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),he=" is not allowed to change after `createInstance` or `loadWasm` is called.",xr=!ie&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Dr=!ie&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",ft=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!ie){let r=document.createElement("a");r.href=t[e],t[e]=r.href}t[e].endsWith("/")||(t[e]+="/")}}return t},dt=t=>t&&typeof t=="object"&&typeof t.then=="function";class At extends Promise{constructor(e){let r,n;super((o,i)=>{r=o,n=i}),this._s="pending",this.resolve=o=>{this.isPending&&(dt(o)?this.task=o:(this._s="fulfilled",r(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",n(o))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,dt(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const n=await r;e===this._task&&this.resolve(n)}catch(n){e===this._task&&this.reject(n)}})()}get isEmpty(){return this._task==null}}var Q,ce,Te,ht,_t;function Pr(t){return!(!t||typeof t!="object"||Array.isArray(t))&&"getImage"in t}function Ve(t){return!(!t||typeof t!="object"||Array.isArray(t))&&"data"in t&&"width"in t&&"height"in t&&"pixelFormat"in t}function gt(t){return!(!t||typeof t!="object"||Array.isArray(t))&&"data"in t&&"region"in t&&"sx"in t&&"sy"in t&&"width"in t&&"height"in t&&"colorMode"in t&&"timeSpent"in t&&"timeStamp"in t&&"isCropped"in t&&"toCanvas"in t&&"_sWidth"in t&&"_sHeight"in t&&"_bUseWebGL"in t}(function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888"})(Q||(Q={})),function(t){t[t.OK=0]="OK",t[t.UNKNOWN=-1e4]="UNKNOWN",t[t.NO_MEMORY=-10001]="NO_MEMORY",t[t.NULL_POINTER=-10002]="NULL_POINTER",t[t.LICENSE_INVALID=-10003]="LICENSE_INVALID",t[t.LICENSE_EXPIRED=-10004]="LICENSE_EXPIRED",t[t.FILE_NOT_FOUND=-10005]="FILE_NOT_FOUND",t[t.FILETYPE_NOT_SUPPORTED=-10006]="FILETYPE_NOT_SUPPORTED",t[t.BPP_NOT_SUPPORTED=-10007]="BPP_NOT_SUPPORTED",t[t.IMAGE_READ_FAILED=-10012]="IMAGE_READ_FAILED",t[t.TIFF_READ_FAILED=-10013]="TIFF_READ_FAILED",t[t.PDF_READ_FAILED=-10021]="PDF_READ_FAILED",t[t.PDF_DLL_MISSING=-10022]="PDF_DLL_MISSING",t[t.RECOGNITION_TIMEOUT=-10026]="RECOGNITION_TIMEOUT",t[t.JSON_PARSE_FAILED=-10030]="JSON_PARSE_FAILED",t[t.JSON_TYPE_INVALID=-10031]="JSON_TYPE_INVALID",t[t.JSON_KEY_INVALID=-10032]="JSON_KEY_INVALID",t[t.JSON_VALUE_INVALID=-10033]="JSON_VALUE_INVALID",t[t.JSON_NAME_KEY_MISSING=-10034]="JSON_NAME_KEY_MISSING",t[t.JSON_NAME_VALUE_DUPLICATED=-10035]="JSON_NAME_VALUE_DUPLICATED",t[t.TEMPLATE_NAME_INVALID=-10036]="TEMPLATE_NAME_INVALID",t[t.PARAMETER_VALUE_INVALID=-10038]="PARAMETER_VALUE_INVALID",t[t.SET_MODE_ARGUMENT_ERROR=-10051]="SET_MODE_ARGUMENT_ERROR",t[t.GET_MODE_ARGUMENT_ERROR=-10055]="GET_MODE_ARGUMENT_ERROR",t[t.CHARACTER_MODEL_FILE_NOT_FOUND=-10100]="CHARACTER_MODEL_FILE_NOT_FOUND"}(ce||(ce={})),function(t){t[t.LST_MANUAL_SPECIFICATION=1]="LST_MANUAL_SPECIFICATION",t[t.LST_PREDETECTED_REGION=2]="LST_PREDETECTED_REGION",t[t.LST_BARCODE=4]="LST_BARCODE"}(Te||(Te={}));class y{constructor(){this._instanceID=void 0,this.oriCanvas=null,this.oriCanvasData=null,this._ifSaveOriginalImageInACanvas=!1,this.canvas=null,this._region=null,this._timeStartRecognize=null,this._timeEnterInnerDLR=null,this.recognizeRecords={},this.drawRegionsultRecords={},this.bDestroyed=!1,this._setWarnnedEx=new Set,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this._idCardUpperLine="",this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this.captureAndRecognizeInParallel=!0,this._selMinLtr=null,this._optGotMinLtr=null,this._minLetter=0,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new be({src:[this._soundSource],onplayerror:(e,r)=>{console.warn(`Sound '${e}' playback failure: ${r}`)}}),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.highlightFillStyle="rgba(254,180,32,0.3)",this.highlightStrokeStyle="rgba(254,180,32,0.9)",this._vinResultArray=[],this.currentSettingsTemplate="cppdefault",this._dce=null,this.imgSource=null,this._maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(y.browserInfo.OS)?2048:4096,this.presetVideoTemplateRegion={regionLeft:0,regionRight:100,regionTop:40,regionBottom:60,regionMeasuredByPercentage:!0},this._onMinLetterSelChange=async e=>{let r=e.target.value;if(r==="got")return;r=JSON.parse(r);let n=JSON.parse(await this.outputRuntimeSettingsToString());n.LabelRecognizerParameterArray[0].LineStringLengthRange=[r,999],n.TextAreaArray[0].LineStringLengthRange=[r,999],await this.updateRuntimeSettingsFromString(n)},this._promiseStartScan=null}static getVersion(){return this._version}static get license(){return this._license}static set license(e){((r,n)=>{const o=r;if(!o._pLoad.isEmpty)throw new Error("`license`"+he);o._license=n})(y,e)}static initLicense(e){y.license=e}static set sessionPassword(e){((r,n)=>{const o=r;if(!o._pLoad.isEmpty)throw new Error("`sessionPassword`"+he);o._sessionPassword=n})(y,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:Ir,worker:Tr,getUserMedia:yt,camera:await Er(),browser:H.browser,version:H.version,OS:H.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");y._engineResourcePath=(r=>{if(r==null&&(r="./"),!ie){let n=document.createElement("a");n.href=r,r=n.href}return r.endsWith("/")||(r+="/"),r})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((r,n)=>{const o=r;if(!o._pLoad.isEmpty)throw new Error("`licenseServer`"+he);o._licenseServer=ft(n)})(y,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((r,n)=>{const o=r;if(!o._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+he);o._deviceFriendlyName=n||""})(y,e)}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static recalculateResultLocation(e,r,n,o,i,a,s){if(e.length>0&&e[0].lineResults.length>0)for(let f of e)for(let u of f.lineResults){let h=u.location.points,_=a/o,p=s/i;h[0].x=h[0].x/_+r,h[1].x=h[1].x/_+r,h[2].x=h[2].x/_+r,h[3].x=h[3].x/_+r,h[0].y=h[0].y/p+n,h[1].y=h[1].y/p+n,h[2].y=h[2].y/p+n,h[3].y=h[3].y/p+n}}static get defaultUIElementURL(){var e;return(e=this._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",y.engineResourcePath)}static set defaultUIElementURL(e){this._defaultUIElementURL=e}_updateMinLtrSel(e){if(this._minLetter=e,this._optGotMinLtr){const r=e?`${e}+ letters`:"any letter";this._optGotMinLtr.innerText=r,this._selMinLtr&&this._optGotMinLtr.parentNode==this._selMinLtr&&(this._selMinLtr.value="got")}}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new be({src:[this._soundSource],onplayerror:(r,n)=>{console.warn(`Sound '${r}' playback failure: ${n}`)}})}get whenToPlaySoundforSuccessfulRead(){return this.bPlaySoundOnSuccessfulRead===!0?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead=e!=="never"&&e}get whenToVibrateforSuccessfulRead(){return this.bVibrateOnSuccessfulRead===!0?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead=e!=="never"&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;y._onLog&&y._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const r=this._dceControler;r.register(this),r.setDisiredValue(this,"refreshInterval",200),r.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength);try{}catch(i){i.name==="ReferenceError"&&window&&(window.ResizeObserver=void 0)}const n=e.getUIElement(),o=this.dce.constructor;if(o._defaultUIElementURL==="@engineResourcePath/dce.ui.html")try{n?n===r._innerSetUI&&(await e.setUIElement(`${o.engineResourcePath}dce.ui.html`),r._innerSetUI=e.getUIElement()):(await e.setUIElement(`${o.engineResourcePath}dlr.ui.html`),r._innerSetUI=e.getUIElement())}catch{await e.setUIElement(o.defaultUIElementURL)}else n||await e.setUIElement(o.defaultUIElementURL);this.callbackCameraChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async i=>{let a=await this._recognize_DCEFrame(i,{bCopyData:!1}),s=null;if(a&&a.length){const{sx:f,sy:u,width:h,height:_,_sWidth:p,_sHeight:T}=i;s=a.map(L=>({lineResults:L.lineResults.map(M=>({location:JSON.parse(JSON.stringify(M.location))}))})),y.recalculateResultLocation(s,f,u,p,T,h,_)}this._drawResults(s),await this.clearMapDecodeRecord();for(let f of a)delete f.bUnduplicated;if(this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let f=this._cloneDecodeResults(a);this.onImageRead(f)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let f of a)for(let u of f.lineResults)this.onUniqueRead(u.text,this._cloneDecodeResults(u));if(this.onMRZRead&&this.dce.isOpen()&&!this._bPauseScan&&["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){let f=this._cloneDecodeResults(a);this._filterVideoModeMrzResult(f)}if(this.onVINRead&&this.dce.isOpen()&&!this._bPauseScan&&["VIN","VIN_NA"].includes(this.currentSettingsTemplate)){let f=this._cloneDecodeResults(a);if(f.length){let u="";for(let h of f)for(let _ of h.lineResults){if(_.characterResults.length===18)_.characterResults[0].characterHConfidence>_.characterResults[17].characterHConfidence?_.characterResults.pop():_.characterResults.shift();else if(_.characterResults.length===19){let p=_.characterResults[0].characterHConfidence+_.characterResults[1].characterHConfidence,T=_.characterResults[17].characterHConfidence+_.characterResults[18].characterHConfidence,L=_.characterResults[0].characterHConfidence+_.characterResults[18].characterHConfidence,M=Math.min(p,T,L);M===p?_.characterResults.splice(0,2):M===T?_.characterResults.splice(17,2):M===L&&(_.characterResults.pop(),_.characterResults.shift())}for(let p of _.characterResults)u+=p.characterH;this.onVINRead(u,a[0].lineResults[0])}}}},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(y._onLog&&y._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this._dlrDrawingLayer=null,this.dce=null)}async setImageSource(e,r){if(e==null)return this.imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this.imgSource=null;else{if(!Pr(e))throw new Error("Invalid value.");this._logoutDCEControler(),this.imgSource=e}r&&r.resultsHighlightBaseShapes&&(this._drawingItemNamespace=r.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:r,ls:n,sp:o,rmk:i}=(a=>{const s=a;if(s._pLoad.isEmpty){let f,u,h=s._license||"",_=JSON.parse(JSON.stringify(s._licenseServer)),p=s._sessionPassword,T=0;if(h.startsWith("t")||h.startsWith("f"))T=0;else if(h.length===0||h.startsWith("P")||h.startsWith("L")||h.startsWith("Y")||h.startsWith("A"))T=1;else{T=2;const L=h.indexOf(":");if(L!=-1&&(h=h.substring(L+1)),h.startsWith("DLS2")){let M;try{let P=h.substring(4);P=atob(P),M=JSON.parse(P)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(h=M.handshakeCode?M.handshakeCode:M.organizationID?M.organizationID:"",typeof h=="number"&&(h=JSON.stringify(h)),_.length===0){let P=[];M.mainServerURL&&(P[0]=M.mainServerURL),M.standbyServerURL&&(P[1]=M.standbyServerURL),_=ft(P)}!p&&M.sessionPassword&&(p=M.sessionPassword),f=M.remark}(h==="200001"||h.startsWith("200001-"))&&(_&&_.length||(h="")),h||(T=1)}if(T&&(ut.crypto||(u="Please upgrade your browser to support online key."),ut.crypto.subtle||(u="Require https to use online key in this browser.")),u){if(T!==1)throw new Error(u);T=0,console.warn(u),s._lastErrorCode=-1,s._lastErrorString=u}return T===1&&(h="",console.warn("Applying for a public trial license ...")),{lt:T,l:h,ls:_,sp:p,rmk:f}}throw new Error("Can't preprocess license again"+he)})(y);this._pLoad.task=async(a,s)=>{let f=y.engineResourcePath+y._workerName;y.engineResourcePath.startsWith(location.origin)||(f=await fetch(f).then(u=>u.blob()).then(u=>URL.createObjectURL(u))),y._dlrWorker=new Worker(f),y._dlrWorker.onerror=u=>{let h=new Error(u.message);s(h)},y._dlrWorker.onmessage=async u=>{let h=u.data?u.data:u;switch(h.type){case"log":y._onLog&&y._onLog(h.message);break;case"load":{h.message&&(h.message=h.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-label-recognizer/#javascript)"));let _,p=!1;e===1&&(p=!0),h.success?(y._dlrWorker.onerror=null,y._version=h.version+"(JS "+y._jsVersion+"."+y._jsEditVersion+")",y._onLog&&y._onLog("load dlr worker success"),h.message&&console.warn(h.message)):(_=new Error(h.message),_.stack=h.stack+`
`+_.stack,p||h.ltsErrorCode==111&&h.message.toLowerCase().indexOf("trial license")!=-1&&(p=!0)),p&&y.showDialog(h.success?"warn":"error",h.message),h.success?a():s(_);break}case"task":{let _=h.id,p=h.body;try{y._taskCallbackMap.get(_)(p),y._taskCallbackMap.delete(_)}catch(T){throw y._taskCallbackMap.delete(_),T}break}case"event":h.body.type==="resourcesLoadStarted"?y.onResourcesLoadStarted&&setTimeout(()=>y.onResourcesLoadStarted(h.body.resourcesPath),0):h.body.type==="resourcesLoadProgress"?y.onResourcesLoadProgress&&setTimeout(()=>y.onResourcesLoadProgress(h.body.resourcesPath,{loaded:h.body.loaded,total:h.body.total}),0):h.body.type==="resourcesLoaded"&&y.onResourcesLoaded&&setTimeout(()=>y.onResourcesLoaded(h.body.resourcesPath),0);break;default:y._onLog&&y._onLog(u)}},y._dlrWorker.postMessage({type:"loadWasm",engineResourcePath:y.engineResourcePath,bd:y._bWasmDebug,v:y._jsVersion,brtk:!!e,bptk:e===1,l:r,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:H,fn:y.deviceFriendlyName,ls:n,sp:o,rmk:i})}}await this._pLoad}static async showDialog(e,r){await(async(n,o,i)=>{if(!n._bNeverShowDialog)try{let a=await fetch(n.engineResourcePath+"dls.license.dialog.html");if(!a.ok)throw Error("Get license dialog fail. Network Error: "+a.statusText);let s=await a.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let f=document.createElement("div");f.innerHTML=s;let u=[];for(let D=0;D<f.childElementCount;++D){let O=f.children[D];O instanceof HTMLStyleElement&&(u.push(O),document.head.append(O))}let h=f.childElementCount==1?f.children[0]:f;h.remove();let _,p,T,L,M,P=[h],U=h.children;for(let D of U)P.push(D);for(let D=0;D<P.length;++D)for(let O of P[D].children)P.push(O);for(let D of P)if(!_&&D.classList.contains("dls-license-mask"))_=D,D.addEventListener("click",O=>{if(D==O.target){h.remove();for(let z of u)z.remove()}});else if(!p&&D.classList.contains("dls-license-icon-close"))p=D,D.addEventListener("click",()=>{h.remove();for(let O of u)O.remove()});else if(!T&&D.classList.contains("dls-license-icon-error"))T=D,o!="error"&&D.remove();else if(!L&&D.classList.contains("dls-license-icon-warn"))L=D,o!="warn"&&D.remove();else if(!M&&D.classList.contains("dls-license-msg-content")){M=D;let O=i;for(;O;){let z=O.indexOf("["),E=O.indexOf("]",z),N=O.indexOf("(",E),k=O.indexOf(")",N);if(z==-1||E==-1||N==-1||k==-1){D.appendChild(new Text(O));break}z>0&&D.appendChild(new Text(O.substring(0,z)));let V=document.createElement("a"),Y=O.substring(z+1,E);V.innerText=Y;let J=O.substring(N+1,k);V.setAttribute("href",J),V.setAttribute("target","_blank"),D.appendChild(V),O=O.substring(k+1)}}document.body.appendChild(h)}catch(a){n._onLog&&n._onLog(a.message||a)}})(this,e,r)}static async createInstanceInWorker(){return await this.loadWasm(),await new Promise((e,r)=>{let n=this._nextTaskID++;this._taskCallbackMap.set(n,o=>{if(o.success)return e(o.instanceID);{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),this._dlrWorker.postMessage({type:"createInstance",id:n,bScanner:!1})})}static async createInstance(e){let r=new y;return r._instanceID=await this.createInstanceInWorker(),e&&e.runtimeSettings&&r.updateRuntimeSettingsFromString(e.runtimeSettings),r}async recognize(e,r){let n;return y._onLog&&y._onLog("recognize(source: any, modelName?: string)"),y._onLog&&(this._timeStartRecognize=Date.now()),r=r||{},e instanceof Blob?n=await this._recognize_Blob(e,r):e instanceof ArrayBuffer?n=await this._recognize_ArrayBuffer(e,r):e instanceof Uint8Array||e instanceof Uint8ClampedArray?n=await this._recognize_Uint8Array(e,r):e instanceof HTMLImageElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap?n=await this._recognize_Image(e,r):e instanceof HTMLCanvasElement?n=await this._recognize_Canvas(e,r):e instanceof HTMLVideoElement?n=await this._recognize_Video(e,r):typeof e=="string"?n=e.substring(0,11)=="data:image/"?await this._recognize_Base64(e,r):await this._recognize_Url(e,r):gt(e)?(r.bCopyData=!0,n=await this._recognize_DCEFrame(e,r)):Ve(e)?(r.bCopyData=!0,n=await this._recognize_DSImage(e,r)):n=await Promise.reject(TypeError("'_recognize(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'string(base64 with image mime)', 'string(url)' or 'object(dceFrame)'.")),this._filterResult(n)||n}async recognizeBase64String(e,r){let n={};r&&(n.modelName=r);let o=await this._recognize_Base64(e,n);return this._filterResult(o)||o}async recognizeUrl(e,r){let n={};r&&(n.modelName=r);let o=await this._recognize_Url(e,n);return this._filterResult(o)||o}async recognizeBuffer(e,r,n,o,i,a){let s;return y._onLog&&y._onLog("recognizeBuffer(buffer,width,height,stride,format)"),y._onLog&&(this._timeStartRecognize=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=await this._recognizeBuffer_Uint8Array(e,r,n,o,i,a):e instanceof ArrayBuffer?s=await this._recognizeBuffer_Uint8Array(new Uint8Array(e),r,n,o,i,a):e instanceof Blob&&(s=await this._recognizeBuffer_Blob(e,r,n,o,i,a)),this._filterResult(s)||s}_filterResult(e){if(!e.length)return e;if(["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){const r=this._filterMrzResult(e);return r.length&&this._verifyCheckDigit(r[0].lineResults),r}["VIN","VIN_NA"].includes(this.currentSettingsTemplate)&&(this._filterVinResult(e),e.length&&this._verifyCheckDigit(e[0].lineResults))}_filterMrzResult(e){let r=[];if(e.length===0)return[];for(let n=0;n<e.length;n++){if(r.push(JSON.parse(JSON.stringify(e[n]))),r[n].lineResults=[],e[n].lineResults.length>=2){if(e[n].lineResults[e[n].lineResults.length-1].text.length>30&&e[n].lineResults.length>=2){for(let o=e[n].lineResults.length-2;o<e[n].lineResults.length;o++)r[n].lineResults.push(e[n].lineResults[o]);return r}if(e[n].lineResults[e[n].lineResults.length-1].text.length<=30&&e[n].lineResults.length>=3){for(let o=e[n].lineResults.length-3;o<e[n].lineResults.length;o++)r[n].lineResults.push(e[n].lineResults[o]);return r}return[]}return[]}}_filterVinResult(e){let r="";if(e.length)for(let n of e)for(let o of n.lineResults){if(o.characterResults.length===18)o.characterResults[0].characterHConfidence>o.characterResults[17].characterHConfidence?o.characterResults.pop():o.characterResults.shift();else if(o.characterResults.length===19){let i=o.characterResults[0].characterHConfidence+o.characterResults[1].characterHConfidence,a=o.characterResults[17].characterHConfidence+o.characterResults[18].characterHConfidence,s=o.characterResults[0].characterHConfidence+o.characterResults[18].characterHConfidence,f=Math.min(i,a,s);f===i?o.characterResults.splice(0,2):f===a?o.characterResults.splice(17,2):f===s&&(o.characterResults.pop(),o.characterResults.shift())}for(let i of o.characterResults)r+=i.characterH;o.text=r}}_verifyCheckDigit(e){const r=this._getMrzType(e);e.length>=3&&["MRZ","idcardMRZ"].includes(this.currentSettingsTemplate)&&(this._idCardUpperLine=e[0].text);const n=o=>!!o&&(["MRZ","passportMRZ"].includes(this.currentSettingsTemplate)&&r==="passport"?/[0-9]/.test(o)?this._checkValidMRP(o):null:["MRZ","idcardMRZ"].includes(this.currentSettingsTemplate)&&r==="idcard"?/[0-9]/.test(o)?this._checkValidIDCard(o,this._idCardUpperLine):null:["MRZ","visaMRZ"].includes(this.currentSettingsTemplate)&&r==="visa"?/[0-9]/.test(o)?this._checkValidMRV(o):null:!!["VIN","VIN_NA"].includes(this.currentSettingsTemplate)&&this._checkValidVIN(o));for(let o of e)o.isCheckDigitMatched=n(o.text)}_getMrzType(e){const r=e[0].text.length,n=e.length,o=e[0].text[0],i=["A","C","I"].includes(o);return r===44&&n===2&&o==="P"?"passport":r===44&&n===2&&o==="V"||r===36&&n===2&&o==="V"?"visa":r===36&&n===2&&i||r===30&&n===3&&i?"idcard":null}async _recognizeBuffer_Uint8Array(e,r,n,o,i,a){return await new Promise((s,f)=>{let u=y._nextTaskID++;y._taskCallbackMap.set(u,h=>{if(h.success){let _,p=y._onLog?Date.now():0;this._lastInnerDecodeDuration=h.duration;try{_=this._handleRetJsonString(h.decodeReturn)}catch(T){return f(T)}if(y._onLog){let T=Date.now();y._onLog("DLR getting message from worker timestamp: "+p),y._onLog("From DLR starting recognizing to entering worker costs: "+(this._timeEnterInnerDLR-this._timeStartRecognize)),y._onLog("From DLR entering worker to returning message from worker costs: "+(p-this._timeEnterInnerDLR)),y._onLog("Handling results from DBR worker costs: "+(T-p)),y._onLog("Total recognize image costs: "+(T-this._timeStartRecognize))}return s(_)}{let _=new Error(h.message);return _.stack=h.stack+`
`+_.stack,f(_)}}),y._onLog&&(this._timeEnterInnerDLR=Date.now()),y._onLog&&y._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDLR),y._dlrWorker.postMessage({type:"recognizeByBuffer",id:u,instanceID:this._instanceID,body:{config:a,imageData:{bytes:e,length:o*n,width:r,height:n,stride:o,format:i}}},[e.buffer]),y._onLog&&a&&a.timeStamp&&y._onLog("Delay of recognizing image: "+(this._timeEnterInnerDLR-a.timeStamp))})}async _recognizeBuffer_Blob(e,r,n,o,i,a){y._onLog&&y._onLog("_recognizeBuffer_Blob(buffer,width,height,stride,format)");const s=e.arrayBuffer?await e.arrayBuffer():await new Promise((f,u)=>{let h=new FileReader;h.readAsArrayBuffer(e),h.onload=()=>{f(h.result)},h.onerror=()=>{u(h.error)}});return await this._recognizeBuffer_Uint8Array(new Uint8Array(s),r,n,o,i,a)}async _recognizeFileInMemory_Uint8Array(e,r){return await new Promise((n,o)=>{let i=y._nextTaskID++;y._taskCallbackMap.set(i,a=>{if(a.success){let s;try{s=this._handleRetJsonString(a.decodeReturn)}catch(f){return o(f)}return n(s)}{let s=new Error(a.message);return s.stack=a.stack+`
`+s.stack,o(s)}}),y._dlrWorker.postMessage({type:"recognizeFileInMemory",id:i,instanceID:this._instanceID,body:{config:r,bytes:e}})})}async _recognize_Blob(e,r){y._onLog&&y._onLog("_recognize_Blob(blob: Blob)");let n=null,o=null;if(typeof createImageBitmap!="undefined")try{n=await createImageBitmap(e)}catch{}n||(o=await function(a){return new Promise((s,f)=>{let u=URL.createObjectURL(a),h=new Image;h.dlrObjUrl=u,h.src=u,h.onload=()=>{URL.revokeObjectURL(u),s(h)},h.onerror=_=>{f(new Error("Can't convert blob to image : "+(_ instanceof Event?_.type:_)))}})}(e));let i=await this._recognize_Image(n||o,r);return n&&n.close(),i}async _recognize_ArrayBuffer(e,r){return await this._recognize_Blob(new Blob([e]),r)}async _recognize_Uint8Array(e,r){return await this._recognize_Blob(new Blob([e]),r)}async _recognize_Image(e,r){y._onLog&&y._onLog("_recognize_Image(image: HTMLImageElement|ImageBitmap)"),r=r||{};let n,o,i=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,s=Math.max(i,a);if(s>this._maxCvsSideLength){let u=this._maxCvsSideLength/s;n=Math.round(i*u),o=Math.round(a*u)}else n=i,o=a;this.canvas||(this.canvas=document.createElement("canvas"));const f=this.canvas;return f.width===n&&f.height===o||(f.width=n,f.height=o),f.ctx2d||(f.ctx2d=f.getContext("2d",{willReadFrequently:!0})),f.ctx2d.drawImage(e,0,0,i,a,0,0,n,o),e.dlrObjUrl&&URL.revokeObjectURL(e.dlrObjUrl),await this._recognize_Canvas(f,r)}async _recognize_Canvas(e,r){if(y._onLog&&y._onLog("_recognize_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if(e.width===0||e.height===0)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let n=(e.ctx2d||e.getContext("2d")).getImageData(0,0,e.width,e.height).data;return await this._recognizeBuffer_Uint8Array(n,e.width,e.height,4*e.width,Q.IPF_ABGR_8888,r)}async _recognize_Video(e,r){if(y._onLog&&y._onLog("_recognize_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_recognize_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";r=r||{};let n,o,i=e.videoWidth,a=e.videoHeight,s=Math.max(i,a);if(s>this._maxCvsSideLength){let u=this._maxCvsSideLength/s;n=Math.round(i*u),o=Math.round(a*u)}else n=i,o=a;this.canvas||(this.canvas=document.createElement("canvas"));const f=this.canvas;return f.width===n&&f.height===o||(f.width=n,f.height=o),f.ctx2d||(f.ctx2d=f.getContext("2d")),f.ctx2d.drawImage(e,0,0,i,a,0,0,n,o),await this._recognize_Canvas(f,r)}async _recognize_DCEFrame(e,r){if(y._onLog&&y._onLog("_recognize_DCEFrame(dceFrame)"),!gt(e))return[];let n=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:o,height:i,colorMode:a,timeStamp:s}=e;let f;f=r&&r.bCopyData?new Uint8Array(e.data):e.data;let u=null;if(r?(u=JSON.parse(JSON.stringify(r)),u.timeStamp=s):u={timeStamp:s},a==="grey")n=await this._recognizeBuffer_Uint8Array(f,o,i,o,Q.IPF_GRAYSCALED,u);else if(a==="rgba")n=await this._recognizeBuffer_Uint8Array(f,o,i,4*o,Q.IPF_ABGR_8888,u);else{if(a!=="bgra")throw new Error(`Color mode '${a}' is not supported to recognize.`);n=await this._recognizeBuffer_Uint8Array(f,o,i,4*o,Q.IPF_ARGB_8888,u)}return n}async _recognize_DSImage(e,r){if(y._onLog&&y._onLog("_recognize_DSImage(dsImage)"),!Ve(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const u=document.createElement("canvas");let h;switch(u.width=this.width,u.height=this.height,this.pixelFormat){case"grey":h=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<h.length;p+=4)h[p]=this.data[p/4],h[p+1]=this.data[p/4],h[p+2]=this.data[p/4],h[p+3]=255;break;case"rgb":h=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<h.length;p+=4)h[p]=this.data[p],h[p+1]=this.data[p+1],h[p+2]=this.data[p+2],h[p+3]=255;break;case"bgr":h=new Uint8ClampedArray(this.width*this.height*4);for(let p=0;p<h.length;p+=4)h[p]=this.data[p],h[p+1]=this.data[p+1],h[p+2]=this.data[p+2],h[p+3]=255;break;case"rgba":case"bgra":h=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const _=new ImageData(h,this.width,this.height);return u.getContext("2d").putImageData(_,0,0),u}});const{width:n,height:o}=e;let i,a,s,f=e.pixelFormat.toLowerCase();switch(i=r&&r.bCopyData?new Uint8Array(e.data):e.data,f){case"grey":s=Q.IPF_GRAYSCALED,a=n;break;case"rgb":s=Q.IPF_BGR_888,a=3*n;break;case"bgr":s=Q.IPF_RGB_888,a=3*n;break;case"rgba":s=Q.IPF_ABGR_8888,a=4*n;break;case"bgra":s=Q.IPF_ARGB_8888,a=4*n;break;default:throw new Error("The pixel format is not supported to recognize.")}return await this._recognizeBuffer_Uint8Array(i,n,o,a,s,r)}async _recognize_Base64(e,r){if(y._onLog&&y._onLog("_recognize_Base64(base64Str)"),typeof e!="string"&&typeof e!="object")return Promise.reject("'_recognize_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");e.substring(0,11)=="data:image/"&&(e=e.substring(e.indexOf(",")+1));{let n=atob(e),o=n.length,i=new Uint8Array(o);for(;o--;)i[o]=n.charCodeAt(o);return await this._recognize_Blob(new Blob([i]),r)}}async _recognize_Url(e,r){if(y._onLog&&y._onLog("_recognize_Url(url)"),typeof e!="string"&&typeof e!="object")throw TypeError("'_recognize_Url(url, config)': Type of 'url' should be 'string'.");{const n=await new Promise((o,i)=>{const a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.send(),a.onloadend=async()=>{o(a.response)},a.onerror=()=>{i(new Error("Network Error: "+a.statusText))}});return await this._recognize_Blob(n,r)}}async _recognize_FilePath(e,r){throw y._onLog&&y._onLog("_recognize_FilePath(path)"),Error("'_recognize_FilePath(path, config)': The method is only supported in node environment.")}async resetRuntimeSettings(){return this.region=null,this._updateMinLtrSel(0),await new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success)return e();{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),y._dlrWorker.postMessage({type:"resetRuntimeSettings",id:n,instanceID:this._instanceID})})}async updateRuntimeSettingsFromString(e,r=!1){let n=0;if(typeof e=="string")if((e=e.trim()).startsWith("{"))e=JSON.parse(e),r||(this.currentSettingsTemplate=null);else{if(e.length>50)throw new Error("Error: preset longer than 50 letters.");const i=e.toLowerCase().split("-");if(i.length>2)throw new Error(`Error: '${e}' is not supported.`);if(i.includes("numberletter"))n=3,this.currentSettingsTemplate="numberLetter";else if(i.includes("numberuppercase"))n=3,this.currentSettingsTemplate="numberUppercase";else if(i.includes("number"))n=3,this.currentSettingsTemplate="number";else if(i.includes("letter"))n=3,this.currentSettingsTemplate="letter";else if(i.includes("passportmrz"))n=44,this.currentSettingsTemplate="passportMRZ";else if(i.includes("visamrz"))n=36,this.currentSettingsTemplate="visaMRZ";else if(i.includes("idcardmrz"))n=30,this.currentSettingsTemplate="idcardMRZ";else if(i.includes("mrz"))n=30,this.currentSettingsTemplate="MRZ";else if(i.includes("vin_na"))n=17,this.currentSettingsTemplate="VIN_NA";else if(i.includes("vin"))n=17,this.currentSettingsTemplate="VIN";else{if(!i.includes("cppdefault"))throw new Error(`Error: '${e}' is not supported.`);this.currentSettingsTemplate="cppdefault"}if(i.includes("video")){if(!this.dce)throw new Error("'CameraEnhancer' instance is required through 'setImageSource()' when using the 'video' prefix template.");this.region=null,this.dce.setScanRegion(this.presetVideoTemplateRegion)}else this.region=null,this.dce&&(o=this.dce.getScanRegion())&&o.regionLeft===0&&o.regionRight===100&&o.regionTop===40&&o.regionBottom===60&&o.regionMeasuredByPercentage===!0&&this.dce.setScanRegion(null)}else{if(typeof e!="object")throw TypeError("'updateRuntimeSettingsFromString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");r||(this.currentSettingsTemplate=null)}var o;if(typeof e=="object"){const i=e.ReferenceRegionArray[0].Localization,a=i.FirstPoint?{localizationSourceType:Te[i.SourceType],location:{points:[{x:i.FirstPoint[0],y:i.FirstPoint[1]},{x:i.SecondPoint[0],y:i.SecondPoint[1]},{x:i.ThirdPoint[0],y:i.ThirdPoint[1]},{x:i.FourthPoint[0],y:i.FourthPoint[1]}]},regionMeasuredByPercentage:i.MeasuredByPercentage}:null;a&&function(f){return Te.LST_MANUAL_SPECIFICATION==f.localizationSourceType&&f.regionMeasuredByPercentage==1&&JSON.stringify([{x:0,y:100},{x:100,y:0},{x:100,y:100},{x:0,y:100}])===JSON.stringify(f.location.points)}(a)?this.region=null:this.region=a;const s=e.LabelRecognizerParameterArray[0].LineStringLengthRange;n=s?s[0]:0}return this._updateMinLtrSel(n),await new Promise((i,a)=>{let s=y._nextTaskID++;y._taskCallbackMap.set(s,f=>{if(f.success){try{this._handleRetJsonString(f.updateReturn)}catch(u){a(u)}return i()}{let u=new Error(f.message);return u.stack=f.stack+`
`+u.stack,a(u)}}),y._dlrWorker.postMessage({type:"updateRuntimeSettingsFromString",id:s,instanceID:this._instanceID,body:{settings:e}})})}async outputRuntimeSettingsToString(){return await new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success)return e(o.results);{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),y._dlrWorker.postMessage({type:"outputSettingsToString",id:n,instanceID:this._instanceID})})}async updateReferenceRegionFromBarcodeResults(e){return await new Promise((r,n)=>{let o=y._nextTaskID++;y._taskCallbackMap.set(o,i=>{if(i.success)return r();{let a=new Error(i.message);return a.stack=i.stack+`
`+a.stack,n(a)}}),y._dlrWorker.postMessage({type:"updateReferenceRegionFromBarcodeResults",id:o,instanceID:this._instanceID,body:{dbrTextResults:e}})})}static async appendCaffeModelBuffer(e,r){return await new Promise((n,o)=>{let i=y._nextTaskID++;y._taskCallbackMap.set(i,a=>{if(a.success){try{return n()}catch(s){o(s)}return n()}{let s=new Error(a.message);return s.stack=a.stack+`
`+s.stack,o(s)}}),y._dlrWorker.postMessage({type:"appendCaffeModelBuffer",id:i,body:{name:e,folderUrl:r}})})}static async eraseCaffeModelByName(e){return await new Promise((r,n)=>{let o=y._nextTaskID++;y._taskCallbackMap.set(o,i=>{if(i.success)return r();{let a=new Error(i.message);return a.stack=i.stack+`
`+a.stack,n(a)}}),y._dlrWorker.postMessage({type:"eraseCaffeModelByName",id:o,body:{name:e}})})}static async eraseAllCaffeModels(){return await new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success)return e();{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),y._dlrWorker.postMessage({type:"eraseAllCaffeModels",id:n})})}static LabelRecognizerException(e,r){let n,o=ce.UNKNOWN;return typeof e=="number"?(o=e,n=new Error(r)):n=new Error(e),n.code=o,n}_handleRetJsonString(e){let r=ce;if(e.results){const n=this.drawRegionsultRecords,o={};for(let i=0;i<e.results.length;i++){let a=e.results[i];if(a.exception!=null){this._setWarnnedEx.has(a.exception)||(this._setWarnnedEx.add(a.exception),console.warn(a.exception));let s={};a.exception.split(";").forEach(f=>{let u=f.indexOf(":");s[f.substring(0,u)]=f.substring(u+1)}),a.exception=s}for(let s of a.lineResults){const f=s.text;o[f]=1,s.bUnduplicated?(n[f]=n[f]||[]).push(s):n[f]&&(n[f]=[s])}}if(e.records){const i=this.recognizeRecords=e.records;for(let a in n)i[a]||delete n[a];for(let a in n)o[a]||(n[a]=[])}else this.recognizeRecords={},this.drawRegionsultRecords={};return this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!this._setWarnnedEx.has(e.description)&&(this._setWarnnedEx.add(e.description),e.exception==ce.LICENSE_INVALID||e.exception==ce.LICENSE_EXPIRED?console.error(e.description):console.warn(e.description)),e.results}if(e.exception==r.OK)return e.data;throw y.LabelRecognizerException(e.exception,e.description)}async clearMapDecodeRecord(){return await new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success)return e();{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),y._dlrWorker.postMessage({type:"clearMapDecodeRecord",id:n,instanceID:this._instanceID})})}_bindUI(){this.dce&&(this._selMinLtr=this.dce._selMinLtr,this._optGotMinLtr=this.dce._optGotMinLtr,this.dce.singleFrameMode||this._selMinLtr&&this._selMinLtr.addEventListener("change",this._onMinLetterSelChange),this._updateMinLtrSel(this._minLetter))}_unbindUI(){this._selMinLtr&&this._selMinLtr.removeEventListener("change",this._onMinLetterSelChange),this._selMinLtr=null,this._optGotMinLtr=null}async getScanSettings(){return await new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success){let i=o.results;return i.intervalTime=this.intervalTime,i.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,i.soundOnSuccessfullRead=this.soundSource,i.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,i.vibrateDuration=this.vibrateDuration,i.captureAndRecognizeInParallel=this.captureAndRecognizeInParallel,e(i)}{let i=new Error(o.message);return i.stack+=`
`+o.stack,r(i)}}),y._dlrWorker.postMessage({type:"getScanSettings",id:n,instanceID:this._instanceID})})}async updateScanSettings(e){if(!e)return;const r=JSON.parse(JSON.stringify(e));return r.hasOwnProperty("intervalTime")&&(r.intervalTime<0&&(r.intervalTime=0),this.intervalTime=r.intervalTime,delete r.intervalTime),r.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=r.whenToPlaySoundforSuccessfulRead,delete r.whenToPlaySoundforSuccessfulRead),r.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=r.soundOnSuccessfullRead,delete r.soundOnSuccessfullRead),r.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=r.whenToVibrateforSuccessfulRead,delete r.whenToVibrateforSuccessfulRead),r.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=r.vibrateDuration,delete r.vibrateDuration),r.hasOwnProperty("captureAndRecognizeInParallel")&&(this.captureAndRecognizeInParallel=r.captureAndRecognizeInParallel,delete r.captureAndRecognizeInParallel),await new Promise((n,o)=>{let i=y._nextTaskID++;y._taskCallbackMap.set(i,a=>{if(a.success)return n();{let s=new Error(a.message);return s.stack+=`
`+a.stack,o(s)}}),y._dlrWorker.postMessage({type:"updateScanSettings",id:i,instanceID:this._instanceID,body:{settings:e}})})}_cloneDecodeResults(e){if(e instanceof Array){let r=[];for(let n of e)r.push(this._cloneDecodeResults(n));return r}{let r=e;return JSON.parse(JSON.stringify(r,(n,o)=>n=="oriVideoCanvas"||n=="searchRegionCanvas"?void 0:o))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this.imgSource||this._bPauseScan)return y._onLog&&y._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));y._onLog&&y._onLog("======= once read ======="),y._onLog&&(this._timeStartRecognize=Date.now());let e=null,r=null;if(this.dce)e=this._getVideoFrame();else if(this.imgSource&&(r=await this.imgSource.getImage(),!Ve(r)))throw new Error("Invalid DSImage.");if(!e&&!r)return y._onLog&&y._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{let n=[];if(e){n=await this._recognize_DCEFrame(e,{bScanner:!0,bCopyData:!1});let o=null;if(n&&n.length){const{sx:i,sy:a,width:s,height:f,_sWidth:u,_sHeight:h}=e;o=n.map(_=>({lineResults:_.lineResults.map(p=>({location:JSON.parse(JSON.stringify(p.location))}))})),y.recalculateResultLocation(o,i,a,u,h,s,f)}this._drawResults(o)}else r&&(n=await this._recognize_DSImage(r,{bScanner:!0,bCopyData:!1}));return n})().then(n=>{if(y._onLog&&y._onLog(n),this.dce&&this.captureAndRecognizeInParallel){let o=this.array_decodeFrameTimeCost,i=this.array_getFrameTimeCost;const a=()=>{let s=0;if(i&&i.length){let f=Math.min(...o),u=Math.max(...i);f&&u&&(s=f-u)}else s=0;return s>0?s:0};(()=>{for(;o.length>=5;)o.shift();o.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=a()+ +this.intervalTime}if((this.dce&&this.dce.isOpen()||this.imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&n.length){let o=!1;if(this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame")o=!0;else if(this.bPlaySoundOnSuccessfulRead==="unique"){for(let i of n)for(let a of i.lineResults)if(a.bUnduplicated){o=!0;break}}o&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&n.length){let o=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame")o=!0;else if(this.bVibrateOnSuccessfulRead==="unique"){for(let i of n)for(let a of i.lineResults)if(a.bUnduplicated){o=!0;break}}if(o)try{navigator.vibrate(this.vibrateDuration)}catch(i){console.warn("Vibration not allowed. User interaction required: "+(i.message||i))}}if(this.onImageRead){let o=this._cloneDecodeResults(n);for(let i of o)for(let a of i.lineResults)a.bUnduplicated&&delete i.bUnduplicated;this.onImageRead(o)}if(this.onUniqueRead)for(let o of n)for(let i of o.lineResults)i.bUnduplicated&&this.onUniqueRead(i.text,this._cloneDecodeResults(i));if(this.onMRZRead&&["MRZ","passportMRZ","visaMRZ","idcardMRZ"].includes(this.currentSettingsTemplate)){let o=this._cloneDecodeResults(n);this._filterVideoModeMrzResult(o)}if(this.onVINRead&&["VIN","VIN_NA"].includes(this.currentSettingsTemplate)){let o=this._cloneDecodeResults(n);if(o.length){let i=0,a=!1;this._vinResultArrayTimeoutId&&clearTimeout(this._vinResultArrayTimeoutId);let s="";for(let f of o)for(let u of f.lineResults){if(u.characterResults.length===18){let h=u.characterResults[9].location.points[0].x-u.characterResults[8].location.points[1].x;h<2&&(h=2);let _=u.characterResults[1].location.points[0].x-u.characterResults[0].location.points[1].x,p=u.characterResults[17].location.points[0].x-u.characterResults[16].location.points[1].x,T=h===2?3:h;_-h>=T&&p-h<T?u.characterResults.shift():p-h>=T&&_-h<T||u.characterResults[0].characterHConfidence>u.characterResults[17].characterHConfidence?u.characterResults.pop():u.characterResults.shift()}else if(u.characterResults.length===19){let h=u.characterResults[10].location.points[0].x-u.characterResults[9].location.points[1].x;h<2&&(h=2);let _,p,T,L=u.characterResults[1].location.points[0].x-u.characterResults[0].location.points[1].x,M=u.characterResults[18].location.points[0].x-u.characterResults[17].location.points[1].x,P=u.characterResults[2].location.points[0].x-u.characterResults[1].location.points[1].x,U=u.characterResults[17].location.points[0].x-u.characterResults[16].location.points[1].x,D=h===2?3:h;if(u.characterResults[1].characterH==="1"||u.characterResults[2].characterH==="1"||u.characterResults[16].characterH==="1"||u.characterResults[17].characterH==="1"){for(let O=9;O<u.characterResults.length;O++)if(u.characterResults[O].characterH!=="1"){T=u.characterResults[O].location.points[1].x-u.characterResults[O].location.points[0].x;break}u.characterResults[1].characterH==="1"&&(_=T-(u.characterResults[1].location.points[1].x-u.characterResults[1].location.points[0].x)+3),u.characterResults[2].characterH==="1"&&(_=T-(u.characterResults[2].location.points[1].x-u.characterResults[2].location.points[0].x)+3),u.characterResults[16].characterH==="1"&&(p=T-(u.characterResults[16].location.points[1].x-u.characterResults[16].location.points[0].x)+3),u.characterResults[17].characterH==="1"&&(p=T-(u.characterResults[17].location.points[1].x-u.characterResults[17].location.points[0].x)+3)}if(P-h>=(_||D)&&U-h<(p||D))u.characterResults.splice(0,2);else if(U-h>=(p||D)&&P-h<(_||D))u.characterResults.splice(17,2);else if(L>h&&M>h)u.characterResults.pop(),u.characterResults.shift();else{let O=u.characterResults[0].characterHConfidence+u.characterResults[1].characterHConfidence,z=u.characterResults[17].characterHConfidence+u.characterResults[18].characterHConfidence,E=u.characterResults[0].characterHConfidence+u.characterResults[18].characterHConfidence,N=Math.min(O,z,E);N===O?u.characterResults.splice(0,2):N===z?u.characterResults.splice(17,2):N===E&&(u.characterResults.pop(),u.characterResults.shift())}}for(let h of u.characterResults)s+=h.characterH}if(this._vinResultArray.length===5&&this._vinResultArray.shift(),this._vinResultArray.push(s),this._vinResultArray.length>=2)for(let f=0;f<this._vinResultArray.length;f++){for(let u=0;u<this._vinResultArray.length;u++)if(this._vinResultArray[f]===this._vinResultArray[u]&&(i++,i===2)){this.onVINRead(this._vinResultArray[f],n[0].lineResults[0]),a=!0;break}if(i=0,a)break}}else this._vinResultArrayTimeoutId=setTimeout(()=>{this._vinResultArray.shift()},500)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()}).catch(n=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),y._onLog&&y._onLog(n.message||n),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},Math.max(this.intervalTime,1e3)),n.message=="platform error"||console.warn(n.message)})}_filterVideoModeMrzResult(e){for(let r of e){let n="",o=[];r.lineResults.length>=2&&(r.lineResults[r.lineResults.length-1].text.length>30&&r.lineResults.length>=2?(o.push(r.lineResults[r.lineResults.length-2]),o.push(r.lineResults[r.lineResults.length-1])):r.lineResults[r.lineResults.length-1].text.length<=30&&r.lineResults.length>=3&&(o.push(r.lineResults[r.lineResults.length-3]),o.push(r.lineResults[r.lineResults.length-2]),o.push(r.lineResults[r.lineResults.length-1])));for(let i of o)n.length>0&&(n+=`
`),n+=i.text;n.length>0&&(this._verifyCheckDigit(o),this.onMRZRead(n,o))}}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndRecognizeInParallel){if(y._onLog&&y._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(n=>{if(!n)return;let o=n.timeSpent,i=this.array_getFrameTimeCost;for(;i.length>=5;)i.shift();i.push(o)})(e)}else y._onLog&&y._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e){if(!this.dce||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dlrDrawingLayer){if(!this.dce.isOpen())return;this._dlrDrawingLayer=this.dce.getDrawingLayer(2)}const r=this._dlrDrawingLayer;e||(e=[]);let n=this._arrPolygons,o=0;for(let i of e)for(let a of i.lineResults){let s,f=a.location.points;n[o]?(s=n[o],r.hasDrawingItem(s)||r.addDrawingItem(s),s.set("vertices",[{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y},{x:f[2].x,y:f[2].y},{x:f[3].x,y:f[3].y}])):(s=new this._drawingItemNamespace.DT_Polygon([{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y},{x:f[2].x,y:f[2].y},{x:f[3].x,y:f[3].y}]),r.addDrawingItem(s),n[o]=s),o++}for(let i=o;i<n.length;i++)r.removeDrawingItem(n[i]);r.renderAll()}_checkValidVIN(e){return!e||e.length!=17?!1:(n=>{const o=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let a=0;for(let s=0;s<n.length;s++){let f=o.get(n[s]);f&&(a+=f*i[s])}return a%11})(e).toString()===e[8]}_checkValidMRP(e){if(!e||e.length!=44)return!1;const r=(u,h,_)=>{const p=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),T=[7,3,1];let L=0;for(let M=h,P=0;M<=_;M++){let U=p.get(u[M]);U&&(L+=U*T[P%3]),P++}return L%10},n=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),o=r(e,0,8).toString(),i=r(e,13,18).toString(),a=r(e,21,26).toString(),s=r(e,28,41).toString(),f=r(n,0,n.length).toString();return o===e[9]&&i===e[19]&&a===e[27]&&s===e[42]&&f===e[43]}_checkValidMRV(e){if(!e||e.length!=44&&e.length!=36)return!1;const r=(a,s,f)=>{const u=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),h=[7,3,1];let _=0;for(let p=s,T=0;p<=f;p++){let L=u.get(a[p]);L&&(_+=L*h[T%3]),T++}return _%10},n=r(e,0,8).toString(),o=r(e,13,18).toString(),i=r(e,21,26).toString();return n===e[9]&&o===e[19]&&i===e[27]}_checkValidIDCard(e,r){if(!e||e.length!=30&&e.length!=36)return!1;const n=(o,i,a)=>{const s=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),f=[7,3,1];let u=0;for(let h=i,_=0;h<=a;h++){let p=s.get(o[h]);p&&(u+=p*f[_%3]),_++}return u%10};if(e.length===30){if(r&&e===r)return n(e,5,13).toString()===e[14];if(r&&e!==r){const o=`${r.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return n(o,0,o.length-1).toString()===e[29]}}else if(e.length===36){const o=n(e,0,8).toString(),i=n(e,13,18).toString(),a=n(e,21,26).toString(),s=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,f=n(s,0,s.length-1).toString();return o===e[9]&&i===e[19]&&a===e[27]&&f===e[35]}}async startScanning(e){if(!this.dce&&!this.imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new At;let r=null;if(this.dce){if(this.dce.isOpen())e&&this.dce.appendAndShowUI(),r=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else if(r=await this.dce.open(e),!this._promiseStartScan)return null;this._bindUI(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},0)),this._promiseStartScan.resolve(r),r}stopScanning(e){this.dce&&(this._drawResults(null),this._unbindUI(),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this._vinResultArray=[],this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(!this.bDestroyed)return y._onLog&&y._onLog("destroy()"),this.bDestroyed=!0,!this.dce&&this._promiseStartScan||this.stopScanning(!0),this.setImageSource(null),new Promise((e,r)=>{let n=y._nextTaskID++;y._taskCallbackMap.set(n,o=>{if(o.success)return e();{let i=new Error(o.message);return i.stack=o.stack+`
`+i.stack,r(i)}}),y._dlrWorker.postMessage({type:"destroy",id:n,instanceID:this._instanceID})})}}y._jsVersion="2.2.31",y._jsEditVersion="20230728",y._version="loading...(JS "+y._jsVersion+"."+y._jsEditVersion+")",y._license=xr,y._sessionPassword=Dr,y.browserInfo=H,y._pLoad=new At,y._workerName=`dlr-${y._jsVersion}.browser.worker.js`,y._engineResourcePath=Lr,y._licenseServer=[],y._deviceFriendlyName="",y._bWasmDebug=!1,y._nextTaskID=0,y._taskCallbackMap=new Map,y.onResourcesLoadStarted=null,y.onResourcesLoadProgress=null,y.onResourcesLoaded=null,y._lastErrorCode=0,y._lastErrorString="",y._defaultUIElementURL="@engineResourcePath/dlr.ui.html",function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=2147483648]="GTM_REV",t[t.GTM_SKIP=0]="GTM_SKIP"}(ht||(ht={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_REV=2147483648]="RPM_REV",t[t.RPM_SKIP=0]="RPM_SKIP"}(_t||(_t={}));const Mr="https://cdn.jsdelivr.net/npm/dynamsoft-label-recognizer@2.2.31/dist/";let ne;class Re{constructor(){me(this,"settings",[])}async init(){ne||(y.engineResourcePath=Mr,ne=await y.createInstance(),ne.updateRuntimeSettingsFromString("MRZ"))}async detect(e){if(!ne)throw new Error("Dynamsoft Barcode Reader has not been initialized.");const r=Date.now(),n=await ne.recognize(e);console.log(n);const o=Date.now()-r,i=[];return n.forEach(s=>{s.lineResults.forEach(f=>{const u=this.wrapResult(f);i.push(u)})}),{elapsedTime:o,results:i}}wrapResult(e){return{text:e.text,confidence:e.confidence,x1:e.location.points[0].x,x2:e.location.points[1].x,x3:e.location.points[2].x,x4:e.location.points[3].x,y1:e.location.points[0].y,y2:e.location.points[1].y,y3:e.location.points[2].y,y4:e.location.points[3].y}}async updateRuntimeSettings(e){e?e.indexOf("{")!=-1?(console.log("Using JSON template: "+e),await ne.updateRuntimeSettingsFromString(e)):(console.log("Using built-in template: "+e),await ne.updateRuntimeSettingsFromString(e)):await ne.resetRuntimeSettings()}static getSupportedSettings(){return[{name:"template",type:"string"}]}static getDefaultSettings(){return{}}static getSettingOptions(e,r){return[]}async setSettings(e){this.settings=e;for(let r=0;r<e.length;r++){const n=e[r];n.name==="template"&&await this.updateRuntimeSettings(n.value)}}}class Ge{constructor(){me(this,"engine","Dynamsoft");me(this,"reader")}static async createInstance(e){const r=new Ge;return r.setEngine(e),await r.init(),r}setEngine(e){this.engine=e}getEngine(){return this.engine}async init(){this.engine==="Dynamsoft"&&(this.reader=new Re),await this.reader.init()}detect(e){return this.reader.detect(e)}static getEngines(){return["Dynamsoft"]}static getSupportedSettings(e){return Re.getSupportedSettings()}static getDefaultSettings(e){return Re.getDefaultSettings()}static async getSettingOptions(e,r,n){return Re.getSettingOptions(r,n)}async setSupportedSettings(e){return this.reader.setSettings(e)}}const Ce=[],pt=[];function Or(t,e){if(t===e)return 0;const r=t;t.length>e.length&&(t=e,e=r);let n=t.length,o=e.length;for(;n>0&&t.charCodeAt(~-n)===e.charCodeAt(~-o);)n--,o--;let i=0;for(;i<n&&t.charCodeAt(i)===e.charCodeAt(i);)i++;if(n-=i,o-=i,n===0)return o;let a,s,f,u,h=0,_=0;for(;h<n;)pt[h]=t.charCodeAt(i+h),Ce[h]=++h;for(;_<o;)for(a=e.charCodeAt(i+_),f=_++,s=_,h=0;h<n;h++)u=a===pt[h]?f:f+1,f=Ce[h],s=Ce[h]=f>s?u>s?s+1:u:u>f?f+1:u;return s}const Be=t=>t.lastIndexOf(".")!=-1?t.substring(0,t.lastIndexOf(".")):t,Br=async t=>new Promise(function(e,r){const n=new FileReader;n.onload=function(o){e(o.target.result)},n.onerror=function(){r("oops, something went wrong.")},n.readAsDataURL(t)}),Ur=async t=>new Promise(function(e,r){const n=new FileReader;n.onload=function(o){e(o.target.result)},n.onerror=function(){r("oops, something went wrong.")},n.readAsText(t)}),Gr=async t=>{for(let r=0;r<t.info.images.length;r++){const n=t.info.images[r];await X.removeItem(t.info.name+":image:"+n),await X.removeItem(t.info.name+":groundTruth:"+Be(n)+".txt")}const e=await X.getItem(t.info.name+":detectionResultFileNamesList");if(e)for(let r=0;r<e.length;r++){const n=e[r];await X.removeItem(t.info.name+":detectionResult:"+n)}await X.removeItem(t.info.name+":detectionResultFileNamesList"),await X.removeItem(t.info.name+":results.zip"),t.info.images=[]};function zr(t){const e=t.split(",")[0].split(":")[1].split(";")[0],r=atob(t.split(",")[1]),n=[];for(let o=0;o<r.length;o++)n.push(r.charCodeAt(o));return new Blob([new Uint8Array(n)],{type:e})}function Wr(t){return new Promise(function(e,r){const n=new FileReader;n.onload=function(o){o.target&&(typeof o.target.result=="string"?e(o.target.result):r(""))},n.readAsDataURL(t)})}async function Yr(t){const e=await X.getItem(t+":settings");return e||kr()}function kr(){const t=Ge.getEngines(),e=[];for(const r of t){const n={engine:r,displayName:r,settings:[]};e.push(n)}return e}function Jr(t){return new Promise(function(e){setTimeout(e,t)})}function Hr(t,e){if(e<=0||e>t.length-1)return t;{const r=t.splice(e,1)[0];return t.splice(e-1,0,r),t}}function Zr(t,e){if(e<0||e+1>t.length-1)return t;{const r=t.splice(e,1)[0];return t.splice(e+1,0,r),t}}const $r=async(t,e,r)=>{const n=t.info.name,o=[];let i=0,a=0,s=0,f=0;for(let _=0;_<t.info.images.length;_++){const p=t.info.images[_];if(r&&p.split("/")[0]!=r)continue;const T=await X.getItem(n+":groundTruth:"+Be(p)+".txt");if(T){let L="";const M=await X.getItem(n+":detectionResult:"+Be(p)+"-"+e+".json");if(M){const P=JSON.parse(M);s=s+1,L=P.elapsedTime.toString(),i=i+P.elapsedTime;const U=Nr(P.results),D=Fr(T,U);D===1&&(a=a+1);const O={number:_+1,filename:p,groundTruth:T,detectedText:U,time:L,score:parseFloat((D*100).toFixed(2))};f=f+D,o.push(O)}}}const u={fileNumber:s,correctFilesNumber:a,readingRate:parseFloat((a/s*100).toFixed(2)),score:parseFloat((f/s*100).toFixed(2)),averageTime:parseFloat((i/s).toFixed(2))};return{name:e,metrics:u,rows:o}};function Nr(t){let e="";for(let r=0;r<t.length;r++){const n=t[r];e=e+n.text,r<t.length-1&&(e=e+`\r
`)}return e}function Fr(t,e){const r=Or(t,e);return 1-r/Math.max(t.length,e.length)}export{Wr as B,Ge as M,ye as a,Yr as b,ve as c,$r as d,Ur as e,Br as f,Be as g,zr as h,Nr as i,Zr as j,X as l,Hr as m,Gr as r,Jr as s};
